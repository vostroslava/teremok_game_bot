import logging
import random

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    CallbackQueryHandler,
    ContextTypes,
)

# -----------------------------
# –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
# -----------------------------
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
)
logger = logging.getLogger(__name__)

# ‚ùó –°–Æ–î–ê –í–°–¢–ê–í–¨ –°–í–û–ô –†–ê–ë–û–ß–ò–ô –¢–û–ö–ï–ù –û–¢ BotFather
TELEGRAM_TOKEN = "8200223342:AAHbh2Poc73PA65-HN9zrDGwmnESU5kw-ac"

# -----------------------------
# –¢–ò–ü–ê–ñ–ò –¢–ï–†–ï–ú–ö–ê (–ö–û–î–´ + –õ–ï–ô–ë–õ–´)
# -----------------------------
TYPES = {
    "BIRD":   {"label": "üê¶ –ü—Ç–∏—Ü–∞"},
    "HAMSTER": {"label": "üêπ –•–æ–º—è–∫"},
    "FOX":    {"label": "ü¶ä –õ–∏—Å–∞"},
    "RAT":    {"label": "üêÄ –ö—Ä—ã—Å–∞"},
    "PRO":    {"label": "üëî –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª"},
    "BEAR":   {"label": "üêª –ú–µ–¥–≤–µ–¥—å"},
    "ALPHA":  {"label": "üÖ∞Ô∏è –ê–ª—å—Ñ–∞-–ª–∏–¥–µ—Ä"},
    "BETA":   {"label": "üÖ±Ô∏è –ë–µ—Ç–∞-–ª–∏–¥–µ—Ä"},
}

# -----------------------------
# –ë–ê–ó–û–í–ê–Ø –ö–û–ú–ê–ù–î–ê –ö–û–ú–ü–ê–ù–ò–ò
# (2 –ü—Ç–∏—Ü—ã, 2 –•–æ–º—è–∫–∞, 3 –õ–∏—Å—ã, 1 –ö—Ä—ã—Å–∞, 1 –ü—Ä–æ—Ñ–∏, 1 –ú–µ–¥–≤–µ–¥—å, 1 –ê–ª—å—Ñ–∞, 1 –ë–µ—Ç–∞)
# -----------------------------
BASE_CHARACTERS = [
    # üêª –ú–µ–¥–≤–µ–¥—å ‚Äî —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫
    {
        "id": "mikhail",
        "name": "–ú–∏—Ö–∞–∏–ª",
        "role": "—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏",
        "correct_type": "BEAR",
        "description": (
            "–ú–∏—Ö–∞–∏–ª ‚Äî –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å –∫–æ–º–ø–∞–Ω–∏–∏. –ö–æ–≥–¥–∞-—Ç–æ —Å–∞–º —Å—Ç–æ—è–ª —É —Å—Ç–∞–Ω–∫–∞/–Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ, "
            "—Å–≤–æ–∏–º–∏ —Ä—É–∫–∞–º–∏ –ø–æ–¥–Ω–∏–º–∞–ª –ø–µ—Ä–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã. –°–µ–π—á–∞—Å —á–∞—â–µ –≥–æ–≤–æ—Ä–∏—Ç: "
            "¬´–Ø —É–∂–µ –≤—Å—ë —ç—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏–ª¬ª, ¬´–º–µ–Ω—è —Ç–∞–∫–∏–º –Ω–µ —É–¥–∏–≤–∏—à—å¬ª.\n\n"
            "–û–Ω —Ü–µ–Ω–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —É—Å—Ç–æ–π—á–∏–≤—É—é –ø—Ä–∏–±—ã–ª—å –∏ –Ω–∞–¥—ë–∂–Ω—ã—Ö –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞—é—Ç "
            "–ª–∏—à–Ω–µ–π —Å—É–µ—Ç—ã. –ö –Ω–æ–≤—ã–º –∏–¥–µ—è–º –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: —Å–Ω–∞—á–∞–ª–∞ –≤—ã—Å–ª—É—à–∞–µ—Ç, –ø–æ—Ç–æ–º —Å–ø—Ä–æ—Å–∏—Ç, "
            "—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ —Å—Ç–æ–∏—Ç –∏ —á—Ç–æ –∫–æ–º–ø–∞–Ω–∏—è –ø–æ–ª—É—á–∏—Ç –Ω–∞ –≤—ã—Ö–æ–¥–µ. –ú–æ–∂–µ—Ç –¥–æ–ª–≥–æ —Ç—è–Ω—É—Ç—å —Å —Ä–µ—à–µ–Ω–∏—è–º–∏, "
            "–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ä–µ—á—å –ø—Ä–æ —Ä–∞–¥–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.\n\n"
            "–ü—Ä–∏ —ç—Ç–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —á—É–≤—Å—Ç–≤—É—é—Ç: –µ—Å–ª–∏ –ú–∏—Ö–∞–∏–ª –≤—Å—Ç–∞–ª –∑–∞ –∫–æ–≥–æ-—Ç–æ –≥–æ—Ä–æ–π, —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ "
            "–ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–≥–ª–∞—Å–Ω—É—é ¬´–∫—Ä—ã—à—É¬ª. –û–Ω —Ä–µ–¥–∫–æ –≤–º–µ—à–∏–≤–∞–µ—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–∫—É, –Ω–æ –µ–≥–æ —Å–ª–æ–≤–æ –≤–µ—Å–∏—Ç –º–Ω–æ–≥–æ."
        ),
        "explanation": (
            "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ú–µ–¥–≤–µ–¥—å: –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—à–ª—ã–π –æ–ø—ã—Ç –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω –∫ —Ä–µ–∑–∫–∏–º "
            "–∏–∑–º–µ–Ω–µ–Ω–∏—è–º, —Ü–µ–Ω–∏—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç—å –∏ ¬´—Å–≤–æ–∏—Ö¬ª –ª—é–¥–µ–π, –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –ª–µ–∑–µ—Ç –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Å—É–µ—Ç—É."
        ),
    },

    # üÖ∞Ô∏è –ê–ª—å—Ñ–∞-–ª–∏–¥–µ—Ä ‚Äî –≥–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä / –∏–¥–µ–æ–ª–æ–≥
    {
        "id": "natalia",
        "name": "–ù–∞—Ç–∞–ª—å—è",
        "role": "–≥–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä",
        "correct_type": "ALPHA",
        "description": (
            "–ù–∞—Ç–∞–ª—å—è ‚Äî –ª–∏—Ü–æ –∫–æ–º–ø–∞–Ω–∏–∏. –ù–∞ –≤—Å—Ç—Ä–µ—á–∞—Ö —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã –≥–æ–≤–æ—Ä–∏—Ç –Ω–µ —Ç–æ–ª—å–∫–æ "
            "–æ –ø–ª–∞–Ω–∞—Ö –Ω–∞ –∫–≤–∞—Ä—Ç–∞–ª, –Ω–æ –∏ –æ —Ç–æ–º, ¬´–∫–∞–∫—É—é –∫–æ–º–ø–∞–Ω–∏—é –º—ã —Å—Ç—Ä–æ–∏–º¬ª, ¬´–∫–∞–∫—É—é –∫—É–ª—å—Ç—É—Ä—É —Ö–æ—Ç–∏–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å¬ª.\n\n"
            "–ï—ë —Ä–µ—á–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç: –æ–Ω–∞ –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ –≤ –æ–±—â–∏–π —á–∞—Ç –∏ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç —Å–æ–±—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤–æ–∫—Ä—É–≥ "
            "—Å–ª–æ–∂–Ω–æ–π —Ü–µ–ª–∏. –ü—Ä–∏ —ç—Ç–æ–º –Ω–µ –ª—é–±–∏—Ç –º–µ–ª–æ—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–∫—É –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å: –µ–π –≤–∞–∂–Ω–æ, "
            "—á—Ç–æ–±—ã –ª—é–¥–∏ —Å–∞–º–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞–ª–∏—Å—å –¥–æ –∏–¥–µ–∏.\n\n"
            "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –≤ –∫–æ–º–∞–Ω–¥–µ –±—å—ë—Ç –ø–æ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º –∏ —è–¥—Ä—É, –ù–∞—Ç–∞–ª—å—è –≥–æ—Ç–æ–≤–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∂—ë—Å—Ç–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è, "
            "–¥–∞–∂–µ –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –ø—Ä–∏–Ω–æ—Å–∏—Ç –¥–µ–Ω—å–≥–∏."
        ),
        "explanation": (
            "–ê–ª—å—Ñ–∞-–ª–∏–¥–µ—Ä: —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∏–¥–µ—é –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –∑–∞–∂–∏–≥–∞–µ—Ç –ª—é–¥–µ–π, –∑–∞–¥–∞—ë—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è "
            "–∏ –≥–æ—Ç–æ–≤–∞ –æ—Ç—Å—Ç–∞–∏–≤–∞—Ç—å —è–¥—Ä–æ –¥–∞–∂–µ —Ü–µ–Ω–æ–π –∂—ë—Å—Ç–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π."
        ),
    },

    # üÖ±Ô∏è –ë–µ—Ç–∞-–ª–∏–¥–µ—Ä ‚Äî –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –º–µ–∂–¥—É ¬´–≤–µ—Ä—Ö–æ–º¬ª –∏ –∫–æ–º–∞–Ω–¥–æ–π
    {
        "id": "sergey",
        "name": "–°–µ—Ä–≥–µ–π",
        "role": "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂",
        "correct_type": "BETA",
        "description": (
            "–°–µ—Ä–≥–µ–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–º, –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º –∏ —Ä—è–¥–æ–≤—ã–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏. "
            "–°–≤–µ—Ä—Ö—É –∫ –Ω–µ–º—É –ø—Ä–∏—Ö–æ–¥—è—Ç –ø–ª–∞–Ω—ã, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –∏ —Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏, —Å–Ω–∏–∑—É ‚Äî —É—Å—Ç–∞–ª–æ—Å—Ç—å, –≤–æ–ø—Ä–æ—Å—ã –∏ —ç–º–æ—Ü–∏–∏.\n\n"
            "–û–Ω —Ö–æ—Ä–æ—à–æ —á—É–≤—Å—Ç–≤—É–µ—Ç –ª—é–¥–µ–π: –∑–Ω–∞–µ—Ç, –∫–æ–º—É —Å–µ–π—á–∞—Å –º–æ–∂–Ω–æ –¥–∞—Ç—å —Å–ª–æ–∂–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –∞ –∫–æ–≥–æ –ª—É—á—à–µ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å. "
            "–£–º–µ–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–µ —Ä–µ—á–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏: –∑–≤–æ–Ω–∫–∏, –≤—Å—Ç—Ä–µ—á–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã.\n\n"
            "–°–µ—Ä–≥–µ–π –∑–∞—â–∏—â–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø–µ—Ä–µ–¥ –≤–µ—Ä—Ö–æ–º, –Ω–æ –∏ —Å–∞–º –∂—ë—Å—Ç–∫–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–≤–∞–ª—ã. –ß–∞—Å—Ç–æ –∏—â–µ—Ç –±–∞–ª–∞–Ω—Å, "
            "–ø–µ—Ä–µ–≥—Ä—É–∂–∞—è —Å–µ–±—è."
        ),
        "explanation": (
            "–ë–µ—Ç–∞-–ª–∏–¥–µ—Ä: –æ–Ω –Ω–µ –ø—Ä–æ –∏–¥–µ–æ–ª–æ–≥–∏—é, –∞ –ø—Ä–æ –ø—Ä–æ–≤–æ–¥–∫—É —Ä–µ—à–µ–Ω–∏–π —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ –∏ –æ–±—Ä–∞—Ç–Ω–æ. "
            "–î–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã, –ø–æ–Ω–∏–º–∞–µ—Ç –ª—é–¥–µ–π –∏ –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å—ã –∫–æ–º–∞–Ω–¥—ã –∏ –∫–æ–º–ø–∞–Ω–∏–∏."
        ),
    },

    # üê¶ –ü—Ç–∏—Ü–∞ ‚Ññ1
    {
        "id": "katya",
        "name": "–ö–∞—Ç—è",
        "role": "–º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º",
        "correct_type": "BIRD",
        "description": (
            "–ö–∞—Ç—è –±—ã—Å—Ç—Ä–æ –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è –Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç, –∞–∫—Ü–∏—è –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç "
            "—Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ ‚Äî –æ–Ω–∞ –ø–µ—Ä–≤–∞—è –ø—Ä–æ—Å–∏—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å. –õ—é–±–∏—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤–æ –≤—Å—ë–º, —á—Ç–æ —Å–≤—è–∑–∞–Ω–æ "
            "—Å –¥–≤–∏–∂–µ–Ω–∏–µ–º: –∏–≤–µ–Ω—Ç—ã, —Å—ä—ë–º–∫–∏, –Ω–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã.\n\n"
            "–ï—Å–ª–∏ —Ç–µ–º–∞ –∑–∞—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –≤ —Ä—É—Ç–∏–Ω—É, –∏–Ω—Ç–µ—Ä–µ—Å –ø–∞–¥–∞–µ—Ç. –û–Ω–∞ –ª–µ–≥–∫–æ —Å–º–æ—Ç—Ä–∏—Ç –≤ —Å—Ç–æ—Ä–æ–Ω—É –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, "
            "–µ—Å–ª–∏ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ ¬´—Ç–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ¬ª.\n\n"
            "–ö–∞—Ç—è —Ü–µ–Ω–∏—Ç —Å–≤–æ–±–æ–¥—É, –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ, –∞ –Ω–µ ¬´—Å–∏–¥–µ—Ç—å –Ω–∞ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ¬ª."
        ),
        "explanation": (
            "–ü—Ç–∏—Ü–∞: –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Äî —Ç—è–≥–∞ –∫ –Ω–æ–≤–∏–∑–Ω–µ –∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ –±—ã—Å—Ç—Ä–æ–µ –æ—Å—Ç—ã–≤–∞–Ω–∏–µ, "
            "—Å–º–µ–Ω–∞ –º–µ—Å—Ç —Ä–∞–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∏–∑-–∑–∞ –¥–µ–Ω–µ–≥ –∏–ª–∏ —Å—Ç–∞—Ç—É—Å–∞."
        ),
    },

    # üê¶ –ü—Ç–∏—Ü–∞ ‚Ññ2
    {
        "id": "artem",
        "name": "–ê—Ä—Ç—ë–º",
        "role": "–º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ / SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "correct_type": "BIRD",
        "description": (
            "–ê—Ä—Ç—ë–º –∂–∏–≤—ë—Ç –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–º –ø–æ—Ç–æ–∫–µ. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç –∏–¥–µ–∏ –ø—Ä–æ –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ "
            "–º–µ—Ö–∞–Ω–∏–∫–∏ –≤–æ–≤–ª–µ—á–µ–Ω–∏—è. –ï–º—É –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–∏–ø–æ—Ç–µ–∑ —Å—Ä–∞–∑—É –∏ —Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ ¬´–∑–∞–π–¥—ë—Ç¬ª.\n\n"
            "–û—Ç—á—ë—Ç—ã –∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–∞—é—Ç—Å—è —Ç—è–∂–µ–ª–æ: –∑–∞–ø—É—Å–∫–∞—Ç—å –µ–º—É –≥–æ—Ä–∞–∑–¥–æ –ª–µ–≥—á–µ, —á–µ–º –¥–æ–ª–≥–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å "
            "—Ä—É—Ç–∏–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏.\n\n"
            "–õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ –±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å."
        ),
        "explanation": (
            "–ü—Ç–∏—Ü–∞: –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ, –∏–Ω—Ç–µ—Ä–µ—Å –∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º, —Å–ª–∞–±–∞—è –ª—é–±–æ–≤—å –∫ —Ä—É—Ç–∏–Ω–µ –∏ –æ—Ç—á—ë—Ç–∞–º. "
            "–ú–æ—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∞–º –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–± –∏ —è—Ä–∫–∞—è –¥–∏–Ω–∞–º–∏–∫–∞."
        ),
    },

    # üêπ –•–æ–º—è–∫ ‚Ññ1
    {
        "id": "igor",
        "name": "–ò–≥–æ—Ä—å",
        "role": "–º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º",
        "correct_type": "HAMSTER",
        "description": (
            "–ò–≥–æ—Ä—å —Å–ø–æ–∫–æ–π–Ω–æ –¥–µ–ª–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É: –ø—Ä–æ–∑–≤–∞–Ω–∏–≤–∞–µ—Ç –±–∞–∑—É, –≤–µ–¥—ë—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –≤–æ—Ä–æ–Ω–∫–µ, "
            "–≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–ª–∞–Ω –Ω–∞ —Å—Ä–µ–¥–Ω–µ–º —É—Ä–æ–≤–Ω–µ. –í—Å–µ–≥–¥–∞ –∑–∞—Ä–∞–Ω–µ–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –∑–∞—Ä–ø–ª–∞—Ç—É, –ø—Ä–µ–º–∏–∏, –≥—Ä–∞—Ñ–∏–∫, "
            "–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–µ –≤—ã—Ö–æ–¥–Ω—ã–µ.\n\n"
            "–ù–µ –ª—é–±–∏—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã –ø–ª–∞–Ω–∫–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç. "
            "–ö–æ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª–∞ –º–µ–Ω—è—é—Ç—Å—è ¬´–ø–æ —Ö–æ–¥—É –∏–≥—Ä—ã¬ª, –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç—Ç–æ –∫–∞–∫ —É–≥—Ä–æ–∑—É –∏ –º–æ–∂–µ—Ç —É—Ö–æ–¥–∏—Ç—å "
            "–≤ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á."
        ),
        "explanation": (
            "–•–æ–º—è–∫: –±–∞–∑–∞ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ ‚Äî –¥–µ–Ω—å–≥–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –í–∞–∂–Ω—ã –ø–æ–Ω—è—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ "
            "–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏–π. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –ª–æ–º–∞—é—Ç ‚Äî –º–æ—Ç–∏–≤–∞—Ü–∏—è –ø–∞–¥–∞–µ—Ç."
        ),
    },

    # üêπ –•–æ–º—è–∫ ‚Ññ2
    {
        "id": "svetlana",
        "name": "–°–≤–µ—Ç–ª–∞–Ω–∞",
        "role": "–æ—Ñ–∏—Å-–º–µ–Ω–µ–¥–∂–µ—Ä / –±—É—Ö–≥–∞–ª—Ç–µ—Ä –ø–æ —Ä–∞—Å—á—ë—Ç–∞–º",
        "correct_type": "HAMSTER",
        "description": (
            "–°–≤–µ—Ç–ª–∞–Ω–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Å—á–µ—Ç–∞, –æ–ø–ª–∞—Ç—ã –∏ –±—ã—Ç–æ–≤—É—é —á–∞—Å—Ç—å –æ—Ñ–∏—Å–∞. "
            "–õ—é–±–∏—Ç, –∫–æ–≥–¥–∞ –≤—Å—ë —Ä–∞–∑–ª–æ–∂–µ–Ω–æ –ø–æ –ø–∞–ø–∫–∞–º, –∞ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–¥—É—Ç –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É.\n\n"
            "–†–µ–∑–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ ¬´—ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏¬ª –≤—ã–∑—ã–≤–∞—é—Ç —Ç—Ä–µ–≤–æ–≥—É: "
            "–æ–Ω–∞ –±–æ–∏—Ç—Å—è, —á—Ç–æ –∫—Ç–æ-—Ç–æ —á—Ç–æ-—Ç–æ –∑–∞–±—É–¥–µ—Ç, –∞ —Ç—É—à–∏—Ç—å –ø–æ–∂–∞—Ä –ø—Ä–∏–¥—ë—Ç—Å—è –µ–π.\n\n"
            "–í –æ—Ç–≤–µ—Ç –Ω–∞ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–π —Ñ—Ä–æ–Ω—Ç —Ä–∞–±–æ—Ç—ã –æ–Ω–∞ –æ—á–µ–Ω—å –ª–æ—è–ª—å–Ω–∞ –∏ –Ω–∞–¥—ë–∂–Ω–∞."
        ),
        "explanation": (
            "–•–æ–º—è–∫: –æ—Ä–∏–µ–Ω—Ç–∏—Ä –Ω–∞ –ø–æ—Ä—è–¥–æ–∫, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏. "
            "–ú–∞–ª–æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ –∏–ª–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è—Ö, –Ω–æ —Å–∏–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ö–∞–æ—Å."
        ),
    },

    # ü¶ä –õ–∏—Å–∞ ‚Ññ1
    {
        "id": "marina",
        "name": "–ú–∞—Ä–∏–Ω–∞",
        "role": "–∞–∫–∫–∞—É–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∫–ª—é—á–µ–≤—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º",
        "correct_type": "FOX",
        "description": (
            "–ú–∞—Ä–∏–Ω–∞ –ª–µ–≥–∫–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Ç–∞–∫—Ç —Å –ª—é–¥—å–º–∏: –∫–ª–∏–µ–Ω—Ç—ã –æ—Ç–º–µ—á–∞—é—Ç –µ—ë –æ–±–∞—è–Ω–∏–µ –∏ —É–º–µ–Ω–∏–µ —Å–≥–ª–∞–¥–∏—Ç—å –æ—Å—Ç—Ä—ã–µ –º–æ–º–µ–Ω—Ç—ã. "
            "–õ—é–±–∏—Ç –≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç—É—Å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤, —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –≤–∞–∂–Ω—ã—Ö –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∞—Ö, –µ–∑–¥–∏—Ç—å –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è.\n\n"
            "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–º–æ—Ç—Ä–∏—Ç, –≥–¥–µ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–æ—Å—Ç–∞: –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏, –¥–æ—Å—Ç—É–ø –∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É. "
            "–ï—Å–ª–∏ –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—Ç –¥–ª—è —Å–µ–±—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤, –º–æ–∂–µ—Ç –∏—Å–∫–∞—Ç—å –±–æ–ª–µ–µ ¬´–≤—ã–≥–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ¬ª."
        ),
        "explanation": (
            "–õ–∏—Å–∞: —Å–æ—á–µ—Ç–∞–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –≤—ã–≥–æ–¥—É –∏ —Å—Ç–∞—Ç—É—Å —Å —Å–∏–ª—å–Ω—ã–º–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –Ω–∞–≤—ã–∫–∞–º–∏. "
            "–í–∞–∂–Ω–æ –±—ã—Ç—å ¬´–≤ —Ü–µ–Ω—Ç—Ä–µ¬ª –∏ –∏–º–µ—Ç—å –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –ª–∏—á–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞."
        ),
    },

    # ü¶ä –õ–∏—Å–∞ ‚Ññ2
    {
        "id": "lera",
        "name": "–õ–µ—Ä–∞",
        "role": "PR-–º–µ–Ω–µ–¥–∂–µ—Ä / –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π",
        "correct_type": "FOX",
        "description": (
            "–õ–µ—Ä–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤–Ω–µ—à–Ω—é—é –∫–∞—Ä—Ç–∏–Ω–∫—É –∫–æ–º–ø–∞–Ω–∏–∏: –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞. "
            "–ß—É–≤—Å—Ç–≤—É–µ—Ç, –≥–¥–µ –º–æ–∂–Ω–æ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –±—Ä–µ–Ω–¥ –∏ —Å –∫–µ–º –≤—ã–≥–æ–¥–Ω–æ –ø–æ–¥—Ä—É–∂–∏—Ç—å—Å—è.\n\n"
            "–õ—é–±–∏—Ç –±—ã—Ç—å –Ω–∞ –≤–∏–¥—É, —á–∞—Å—Ç–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö. "
            "–ï—Å–ª–∏ –µ—ë —É–±–∏—Ä–∞—é—Ç –∏–∑ –∑–æ–Ω –≤–ª–∏—è–Ω–∏—è –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –∑–∞–¥–∞—á, –º–æ—Ç–∏–≤–∞—Ü–∏—è –±—ã—Å—Ç—Ä–æ –ø–∞–¥–∞–µ—Ç."
        ),
        "explanation": (
            "–õ–∏—Å–∞: –≤–∞–∂–Ω—ã –≤–Ω–µ—à–Ω–∏–µ —Å–≤—è–∑–∏, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –≤–ª–∏—è–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å. "
            "–ì–ª–∞–≤–Ω—ã–π —Ñ–æ–∫—É—Å ‚Äî –≥–¥–µ –¥–ª—è –Ω–µ—ë –ª–∏—á–Ω–æ –±–æ–ª—å—à–µ —à–∞–Ω—Å–æ–≤ –Ω–∞ –≤—ã–∏–≥—Ä—ã—à."
        ),
    },

    # ü¶ä –õ–∏—Å–∞ ‚Ññ3
    {
        "id": "dima",
        "name": "–î–∏–º–∞",
        "role": "–º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é / –ø—Ä–æ–µ–∫—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä",
        "correct_type": "FOX",
        "description": (
            "–î–∏–º–∞ –≤—Å–µ–≥–¥–∞ –≤ –ø–æ–∏—Å–∫–µ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π: –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞, –ø–∏–ª–æ—Ç—ã, —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã. "
            "–£–º–µ–µ—Ç –∫—Ä–∞—Å–∏–≤–æ –ø—Ä–µ–∑–µ–Ω—Ç–æ–≤–∞—Ç—å –∏–¥–µ–∏ –∏ —É–≤–ª–µ—á—å –∫–æ–ª–ª–µ–≥ –∫–æ–Ω—Ü–µ–ø—Ü–∏–µ–π –Ω–æ–≤–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.\n\n"
            "–ü—Ä–∏ —ç—Ç–æ–º –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–º–æ—Ç—Ä–∏—Ç, —á—Ç–æ –ª–∏—á–Ω–æ –µ–º—É –¥–∞–¥—É—Ç –ø—Ä–æ–µ–∫—Ç—ã: –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏, —Ä–æ—Å—Ç —Å—Ç–∞—Ç—É—Å–∞, "
            "–ø—Ä–∏–±–∞–≤–∫—É –∫ –¥–æ—Ö–æ–¥—É, –≤—ã—Ö–æ–¥ –Ω–∞ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∑–∞–¥–∞—á."
        ),
        "explanation": (
            "–õ–∏—Å–∞: –¥–≤–∏–∂–µ–Ω–∏–µ —Ç—É–¥–∞, –≥–¥–µ –±–æ–ª—å—à–µ –ª–∏—á–Ω–æ–π –≤—ã–≥–æ–¥—ã –∏ —Ä–æ—Å—Ç–∞, —É–º–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –∏–¥–µ–∏, "
            "–≤—ã—Å–æ–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –≤–ª–∏—è–Ω–∏—é."
        ),
    },

    # üêÄ –ö—Ä—ã—Å–∞
    {
        "id": "anton",
        "name": "–ê–Ω—Ç–æ–Ω",
        "role": "–∫–ª—é—á–µ–≤–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º",
        "correct_type": "RAT",
        "description": (
            "–ê–Ω—Ç–æ–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç —Å–µ—Ä—å—ë–∑–Ω—É—é –≤—ã—Ä—É—á–∫—É –∏ –ª—é–±–∏—Ç —ç—Ç–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞—Ç—å: ¬´–µ—Å–ª–∏ —è —É–π–¥—É, –≤—ã —Ç—É—Ç —Ä–∞–∑–≤–∞–ª–∏—Ç–µ—Å—å¬ª. "
            "–í –æ—Ç–¥–µ–ª–µ —É –Ω–µ–≥–æ —Å–≤–æ—è ¬´—Ç—É—Å–æ–≤–∫–∞¬ª ‚Äî –ª—é–¥–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω –¥–µ–ª–∏—Ç—Å—è –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ–º –ø–ª–∞–Ω–∞–º–∏ –∏ —Ä–µ—à–µ–Ω–∏—è–º–∏.\n\n"
            "–ü—Ä–∏ –∫–ª–∏–µ–Ω—Ç–∞—Ö –æ–Ω –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–µ–Ω, –Ω–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ–±–µ –∏–≥—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ –æ–±—â–∏—Ö –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π. "
            "–ú–æ–∂–µ—Ç —à–∞–Ω—Ç–∞–∂–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏ –¥–∞–≤–∏—Ç—å –Ω–∞ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ."
        ),
        "explanation": (
            "–ö—Ä—ã—Å–∞: –ø–æ —Å—É—Ç–∏ –õ–∏—Å–∞ —Å —Å–∏–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º, –Ω–æ –∏–≥—Ä–∞—é—â–∞—è –ø—Ä–æ—Ç–∏–≤ —Å–∏—Å—Ç–µ–º—ã. "
            "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–ª–∏—è–Ω–∏–µ –∏ –≤—ã—Ä—É—á–∫—É –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∞–≤–ª–µ–Ω–∏—è –∏ —à–∞–Ω—Ç–∞–∂–∞."
        ),
    },

    # üëî –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª
    {
        "id": "oleg",
        "name": "–û–ª–µ–≥",
        "role": "–≤–µ–¥—É—â–∏–π —ç–∫—Å–ø–µ—Ä—Ç / –º–µ—Ç–æ–¥–æ–ª–æ–≥",
        "correct_type": "PRO",
        "description": (
            "–û–ª–µ–≥ –ª—É—á—à–µ –¥—Ä—É–≥–∏—Ö –∑–Ω–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç, –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤. "
            "–ï–≥–æ –∑–æ–≤—É—Ç –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ –∫–µ–π—Å—ã –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.\n\n"
            "–ù–µ —Ç–µ—Ä–ø–∏—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∏ —Ö–∞–æ—Å–∞: –µ—Å–ª–∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞ —ç–º–æ—Ü–∏—è—Ö, –∞ –Ω–µ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, "
            "–æ–Ω –æ—Ç–∫—Ä—ã—Ç–æ –æ–± —ç—Ç–æ–º –≥–æ–≤–æ—Ä–∏—Ç. –ú–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Ç–µ–º–∏, –∫—Ç–æ –ø—Ä–∏–Ω–æ—Å–∏—Ç –º–Ω–æ–≥–æ —à—É–º–∞ –∏ –º–∞–ª–æ –∫–∞—á–µ—Å—Ç–≤–∞.\n\n"
            "–î–ª—è –Ω–µ–≥–æ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –∫–æ–º–ø–∞–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏ –¥–∞–≤–∞–ª–∞ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã."
        ),
        "explanation": (
            "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª: –º–æ—Ç–∏–≤–∞—Ü–∏—è —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ, —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö. "
            "–ú–µ–Ω—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ —Å—Ç–∞—Ç—É—Å—É –∏–ª–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º, –±–æ–ª—å—à–µ ‚Äî –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–µ–ª–∞."
        ),
    },
]

# -----------------------------
# –°–¶–ï–ù–´ –°–ò–ú–£–õ–Ø–¶–ò–ò (–ß–ê–°–¢–¨ 2)
# -----------------------------
SCENES = [
    {
        "id": "TEAM_LEAD",
        "title": "–°—Ü–µ–Ω–∞ 1. –ö–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å –ª–∏—Ü–æ–º –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂?",
        "description": (
            "–ü—Ä–æ–¥–∞–∂–∏ —Ä–∞—Å—Ç—É—Ç, –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫ —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º —Ä–µ—à–∞—é—Ç: –Ω—É–∂–Ω–æ —á—ë—Ç–∫–æ –æ–±–æ–∑–Ω–∞—á–∏—Ç—å, "
            "–∫—Ç–æ –±—É–¥–µ—Ç ¬´–ª–∏—Ü–æ–º¬ª –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –ª–∏–¥–µ—Ä–æ–º.\n\n"
            "–û—Ç —ç—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç, –Ω–∞ –∫–æ–≥–æ –Ω–∞—á–Ω—É—Ç —Ä–∞–≤–Ω—è—Ç—å—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏ –∫–∞–∫—É—é –ª–æ–≥–∏–∫—É "
            "—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–Ω–∏ –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å –Ω–æ—Ä–º–æ–π."
        ),
        "question": "–ö–æ–≥–æ –≤—ã–±–µ—Ä–µ—à—å –æ–ø–æ—Ä–Ω—ã–º –ª–∏–¥–µ—Ä–æ–º –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂?",
        "options": [
            {
                "code": "SERGEY",
                "label": "–ù–∞–∑–Ω–∞—á–∏—Ç—å –°–µ—Ä–≥–µ—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –ª–∏–¥–µ—Ä–æ–º –æ—Ç–¥–µ–ª–∞",
                "d_money": 10,
                "d_engagement": 10,
                "d_risk": -5,
                "comment": (
                    "–ë–µ—Ç–∞-–ª–∏–¥–µ—Ä –≤ —Ä–æ–ª–∏ –ª–∏–¥–µ—Ä–∞ –æ—Ç–¥–µ–ª–∞ —É—Å—Ç–æ–π—á–∏–≤–æ —Ç—è–Ω–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã, "
                    "–¥–µ—Ä–∂–∏—Ç –±–∞–ª–∞–Ω—Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∏ —Å–Ω–∏–º–∞–µ—Ç —á–∞—Å—Ç—å –Ω–∞–≥—Ä—É–∑–∫–∏ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞."
                ),
            },
            {
                "code": "ANTON",
                "label": "–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–¥–µ–ª–∞—Ç—å –ê–Ω—Ç–æ–Ω–∞ –≥–ª–∞–≤–Ω—ã–º –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º",
                "d_money": 15,
                "d_engagement": -20,
                "d_risk": 20,
                "comment": (
                    "–ö—Ä—ã—Å–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –ª–∏–¥–µ—Ä–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å: "
                    "–ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–Ω—ã–µ, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–∞–≤–¥—ã–≤–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ."
                ),
            },
            {
                "code": "MARINA",
                "label": "–°–¥–µ–ª–∞—Ç—å –ú–∞—Ä–∏–Ω—É –≤–µ–¥—É—â–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º",
                "d_money": 5,
                "d_engagement": 5,
                "d_risk": 5,
                "comment": (
                    "–õ–∏—Å–∞-–∞–∫–∫–∞—É–Ω—Ç —Ö–æ—Ä–æ—à–æ –¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Ç—è–Ω–µ—Ç —Å—Ç–∞—Ç—É—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏, "
                    "–Ω–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–∏–ª—å–Ω–æ–≥–æ –ë–µ—Ç–∞-–ª–∏–¥–µ—Ä–∞ –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ç—è–Ω—É—Ç—å –æ–¥–µ—è–ª–æ –Ω–∞ —Å–µ–±—è."
                ),
            },
            {
                "code": "KATYA",
                "label": "–ü–æ—Å—Ç–∞–≤–∏—Ç—å –ö–∞—Ç—é –≤ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –ª–∏–¥–µ—Ä—ã, —á—Ç–æ–±—ã ¬´–±—ã–ª–æ –±–æ–ª—å—à–µ –¥–≤–∏–∂—É—Ö–∏¬ª",
                "d_money": 0,
                "d_engagement": -10,
                "d_risk": 10,
                "comment": (
                    "–ü—Ç–∏—Ü–∞ –≤ —Ä–æ–ª–∏ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –¥–∞—ë—Ç –º–Ω–æ–≥–æ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞, –Ω–æ –º–∞–ª–æ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏. "
                    "–•–æ–º—è–∫–∏ –∏ —è–¥—Ä–æ –Ω–∞—á–∏–Ω–∞—é—Ç —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ö–∞–æ—Å."
                ),
            },
        ],
    },
    {
        "id": "BONUSES",
        "title": "–°—Ü–µ–Ω–∞ 2. –ö–∞–∫ —Ä–∞–∑–¥–∞—Ç—å –ø—Ä–µ–º–∏—é –∑–∞ —É–¥–∞—á–Ω—ã–π –∫–≤–∞—Ä—Ç–∞–ª?",
        "description": (
            "–ö–≤–∞—Ä—Ç–∞–ª –∑–∞–∫—Ä—ã—Ç —É—Å–ø–µ—à–Ω–æ, —É –∫–æ–º–ø–∞–Ω–∏–∏ –µ—Å—Ç—å –¥–µ–Ω—å–≥–∏ –Ω–∞ –ø—Ä–µ–º–∏–∏. "
            "–û—Ç —Ç–æ–≥–æ, –∫–∞–∫ —Ç—ã —Å–µ–π—á–∞—Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—à—å –¥–µ–Ω—å–≥–∏, –∑–∞–≤–∏—Å–∏—Ç, –∫–∞–∫–∏–µ —Ç–∏–ø–∞–∂–∏ –±—É–¥—É—Ç —Å—á–∏—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º—É "
            "—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π –∏ –∫—É–¥–∞ –ø–æ–µ–¥–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—è."
        ),
        "question": "–ö–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—à—å –ø—Ä–µ–º–∏—é?",
        "options": [
            {
                "code": "EQUAL",
                "label": "–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –≤—Å–µ–º –ø–æ –æ—Ç–¥–µ–ª—É",
                "d_money": -10,
                "d_engagement": 5,
                "d_risk": 5,
                "comment": (
                    "–•–æ–º—è–∫–∏ –¥–æ–≤–æ–ª—å–Ω—ã: –≤—Å–µ–º –ø–æ—Ä–æ–≤–Ω—É –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ. "
                    "–ù–æ —Å–∏–ª—å–Ω—ã–µ –õ–∏—Å—ã –∏ –ü—Ç–∏—Ü—ã –≤–∏–¥—è—Ç, —á—Ç–æ –∏—Ö –≤–∫–ª–∞–¥ –Ω–µ –æ—Å–æ–±–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö."
                ),
            },
            {
                "code": "TOP3",
                "label": "–ú–∞–∫—Å–∏–º—É–º —Ç–æ–ø-3 –ø–æ –≤—ã—Ä—É—á–∫–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏",
                "d_money": 15,
                "d_engagement": -10,
                "d_risk": 15,
                "comment": (
                    "–õ–∏—Å—ã –∏ –ö—Ä—ã—Å–∞ –ø–æ–ª—É—á–∞—é—Ç —Å–∏–≥–Ω–∞–ª: –≥–ª–∞–≤–Ω–æ–µ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –Ω–µ–≤–∞–∂–Ω–æ. "
                    "–•–æ–º—è–∫–∏ –∏ —á–∞—Å—Ç—å —è–¥—Ä–∞ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç —ç—Ç–æ –∫–∞–∫ –ø–µ—Ä–µ–∫–æ—Å –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏."
                ),
            },
            {
                "code": "CORE_PLUS",
                "label": "–ú–∏–Ω–∏–º—É–º –≤—Å–µ–º + –∑–∞–º–µ—Ç–Ω—ã–π –±–æ–Ω—É—Å —è–¥—Ä—É –∏ –∫–ª—é—á–µ–≤—ã–º –ª—é–¥—è–º",
                "d_money": -5,
                "d_engagement": 15,
                "d_risk": -5,
                "comment": (
                    "–õ—é–¥–∏ —á—É–≤—Å—Ç–≤—É—é—Ç, —á—Ç–æ –±–∞–∑–æ–≤–∞—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å –µ—Å—Ç—å, –ø—Ä–∏ —ç—Ç–æ–º —è–¥—Ä–æ –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ "
                    "–ø–æ–ª—É—á–∞—é—Ç –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ. –≠—Ç–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã."
                ),
            },
        ],
    },
    {
        "id": "RAT_CRISIS",
        "title": "–°—Ü–µ–Ω–∞ 3. –ö—Ä—ã—Å–∞ –∫–∞—á–∞–µ—Ç –ª–æ–¥–∫—É",
        "description": (
            "–ê–Ω—Ç–æ–Ω —É—Å–∏–ª–∏–≤–∞–µ—Ç –¥–∞–≤–ª–µ–Ω–∏–µ: –Ω–∞–º–µ–∫–∞–µ—Ç –Ω–∞ —É—Ö–æ–¥, —Å–æ–±–∏—Ä–∞–µ—Ç –≤–æ–∫—Ä—É–≥ —Å–µ–±—è –≥—Ä—É–ø–ø—É –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã—Ö, "
            "—Å—Ç–∞–≤–∏—Ç —É–ª—å—Ç–∏–º–∞—Ç—É–º—ã –ø–æ —É—Å–ª–æ–≤–∏—è–º. –ü—Ä–∏ —ç—Ç–æ–º –µ–≥–æ –≤—ã—Ä—É—á–∫–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π –ø–æ –æ—Ç–¥–µ–ª—É.\n\n"
            "–û—Ç —Ç–≤–æ–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç, —á—Ç–æ –±—É–¥–µ—Ç –≤–∞–∂–Ω–µ–µ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–Ω—å–≥–∏ "
            "–∏–ª–∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã."
        ),
        "question": "–ö–∞–∫ –ø–æ—Å—Ç—É–ø–∏—à—å —Å –ê–Ω—Ç–æ–Ω–æ–º –∏ —Å–∏—Ç—É–∞—Ü–∏–µ–π –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ?",
        "options": [
            {
                "code": "IGNORE",
                "label": "–ó–∞–∫—Ä—ã—Ç—å –≥–ª–∞–∑–∞: –ø–æ–∫–∞ —Ç–∞—â–∏—Ç –≤—ã—Ä—É—á–∫—É ‚Äî –Ω–µ —Ç—Ä–æ–≥–∞–µ–º",
                "d_money": 10,
                "d_engagement": -20,
                "d_risk": 25,
                "comment": (
                    "–û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∏–¥—è—Ç, —á—Ç–æ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å –∏ —à–∞–Ω—Ç–∞–∂ —Å—Ö–æ–¥—è—Ç —Å —Ä—É–∫, –µ—Å–ª–∏ –ø—Ä–∏–Ω–æ—Å–∏—à—å –¥–µ–Ω—å–≥–∏. "
                    "–Ø–¥—Ä–æ –≤—ã–≥–æ—Ä–∞–µ—Ç, –•–æ–º—è–∫–∏ —É—Ö–æ–¥—è—Ç –≤ –ø–∞—Å—Å–∏–≤, —Ä–∞—Å—Ç—ë—Ç —Å–∫—Ä—ã—Ç—ã–π —Å–∞–±–æ—Ç–∞–∂."
                ),
            },
            {
                "code": "FRAME",
                "label": "–ñ—ë—Å—Ç–∫–∏–π —Ä–∞–∑–≥–æ–≤–æ—Ä 1:1 –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ —Ä–∞–º–∫–∏: –æ—Å—Ç–∞—ë—Ç—Å—è, –Ω–æ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º",
                "d_money": -5,
                "d_engagement": 5,
                "d_risk": -10,
                "comment": (
                    "–°–∏–≥–Ω–∞–ª –∫–æ–º–∞–Ω–¥–µ: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–∂–µ–Ω, –Ω–æ –ø—Ä–∞–≤–∏–ª–∞ –æ–±—â–∏–µ. "
                    "–ß–∞—Å—Ç—å —Ä–∏—Å–∫–∞ —Å–Ω–∏–º–∞–µ—Ç—Å—è, –Ω–æ –µ—Å–ª–∏ —Ä–∞–º–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–ª–æ–≤–∞—Ö, —Å–∏—Ç—É–∞—Ü–∏—è –≤–µ—Ä–Ω—ë—Ç—Å—è."
                ),
            },
            {
                "code": "FAREWELL",
                "label": "–ì–æ—Ç–æ–≤–∏–º –∑–∞–º–µ–Ω—É –∏ –ø—Ä–æ—â–∞–µ–º—Å—è, –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—è —Å–∏—Å—Ç–µ–º—É –ø–æ–¥ –∫–æ–º–∞–Ω–¥—É",
                "d_money": -15,
                "d_engagement": 20,
                "d_risk": -20,
                "comment": (
                    "–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ –±–æ–ª—å–Ω–æ –ø–æ –¥–µ–Ω—å–≥–∞–º, –Ω–æ –∫–æ–º–∞–Ω–¥–∞ –≤–∏–¥–∏—Ç, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≤–∞–∂–Ω–µ–µ —à–∞–Ω—Ç–∞–∂–∞. "
                    "–≠—Ç–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç —è–¥—Ä–æ –∏ –¥–∞—ë—Ç —Å–∏–≥–Ω–∞–ª, —á—Ç–æ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å –Ω–µ –æ–∫—É–ø–∞–µ—Ç—Å—è."
                ),
            },
        ],
    },
]

# ============================================================
#                 –ß–ê–°–¢–¨ 1. –ö–í–ò–ó ¬´–ö–¢–û –ï–°–¢–¨ –ö–¢–û¬ª
# ============================================================

def init_quiz_state(context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–≤–∏–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –æ–±–Ω—É–ª—è–µ–º –æ—Ç–≤–µ—Ç—ã.
    """
    user_data = context.user_data
    characters = BASE_CHARACTERS.copy()
    random.shuffle(characters)
    user_data["quiz"] = {
        "characters": characters,
        "current_index": 0,
        "total": len(characters),
        "phase": "main",          # 'main' –∏–ª–∏ 'retry'
        "answers_first": {},      # –ø–µ—Ä–≤—ã–π –∑–∞—Ö–æ–¥: id -> {chosen, correct}
        "answers_final": {},      # –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç (–ø–æ—Å–ª–µ —Ä–µ—Ç—Ä–∞—è)
        "score_first": 0,
        "retry_ids": [],          # –∏–Ω–¥–µ–∫—Å—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –≥–¥–µ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –±—ã–ª–∞ –æ—à–∏–±–∫–∞
    }


def build_types_keyboard() -> InlineKeyboardMarkup:
    """
    –ö–Ω–æ–ø–∫–∏ —Å —Ç–∏–ø–∞–∂–∞–º–∏.
    """
    buttons = [
        [
            InlineKeyboardButton(TYPES["BIRD"]["label"], callback_data="QUIZ:BIRD"),
            InlineKeyboardButton(TYPES["HAMSTER"]["label"], callback_data="QUIZ:HAMSTER"),
            InlineKeyboardButton(TYPES["FOX"]["label"], callback_data="QUIZ:FOX"),
        ],
        [
            InlineKeyboardButton(TYPES["RAT"]["label"], callback_data="QUIZ:RAT"),
            InlineKeyboardButton(TYPES["PRO"]["label"], callback_data="QUIZ:PRO"),
            InlineKeyboardButton(TYPES["BEAR"]["label"], callback_data="QUIZ:BEAR"),
        ],
        [
            InlineKeyboardButton(TYPES["ALPHA"]["label"], callback_data="QUIZ:ALPHA"),
            InlineKeyboardButton(TYPES["BETA"]["label"], callback_data="QUIZ:BETA"),
        ],
    ]
    return InlineKeyboardMarkup(buttons)


def build_main_question_text(characters, index: int, total: int) -> str:
    """
    –í–æ–ø—Ä–æ—Å –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞.
    """
    ch = characters[index]
    return (
        f"–°–æ—Ç—Ä—É–¥–Ω–∏–∫ {index + 1} –∏–∑ {total}.\n\n"
        f"{ch['name']} ‚Äî {ch['role']}.\n\n"
        f"{ch['description']}\n\n"
        "–ö—Ç–æ —ç—Ç–æ –ø–æ –º–æ–¥–µ–ª–∏ ¬´–¢–µ—Ä–µ–º–æ–∫¬ª?"
    )


def build_retry_question_text(quiz: dict, retry_index: int) -> str:
    """
    –í–æ–ø—Ä–æ—Å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (—Ç–æ–ª—å–∫–æ –ø–æ –æ—à–∏–±–æ—á–Ω—ã–º –∫–µ–π—Å–∞–º).
    """
    characters = quiz["characters"]
    retry_ids = quiz["retry_ids"]
    char_idx = retry_ids[retry_index]
    ch = characters[char_idx]
    total_retry = len(retry_ids)
    return (
        f"–ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–∞–∑–±–æ—Ä ‚Äî –∫–µ–π—Å {retry_index + 1} –∏–∑ {total_retry}.\n\n"
        f"{ch['name']} ‚Äî {ch['role']}.\n\n"
        f"{ch['description']}\n\n"
        "–ö—Ç–æ —ç—Ç–æ –ø–æ –º–æ–¥–µ–ª–∏ ¬´–¢–µ—Ä–µ–º–æ–∫¬ª?"
    )


async def send_first_question(chat_id: int, context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞.
    """
    user_data = context.user_data
    quiz = user_data.get("quiz")
    if not quiz:
        return
    idx = quiz["current_index"]
    total = quiz["total"]
    text = build_main_question_text(quiz["characters"], idx, total)
    keyboard = build_types_keyboard()
    await context.bot.send_message(chat_id=chat_id, text=text, reply_markup=keyboard)


def format_quiz_summary(user_data: dict) -> str:
    """
    –ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∫–≤–∏–∑–∞: –ø–µ—Ä–≤—ã–π –∑–∞—Ö–æ–¥ + –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–∞—É–Ω–¥.
    """
    quiz = user_data.get("quiz", {})
    characters = quiz.get("characters", [])
    answers_first = quiz.get("answers_first", {})
    answers_final = quiz.get("answers_final", {})
    total = len(characters)

    score_first = quiz.get(
        "score_first",
        sum(1 for ch in characters if answers_first.get(ch["id"], {}).get("correct")),
    )
    score_final = sum(
        1 for ch in characters if answers_final.get(ch["id"], {}).get("correct")
    )

    lines = [
        f"–†–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞: {score_first} –∏–∑ {total}.",
        f"–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏: {score_final} –∏–∑ {total}.\n",
        "–†–∞–∑–±–æ—Ä –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º:",
    ]

    for ch in characters:
        ch_id = ch["id"]
        name = ch["name"]
        correct_code = ch["correct_type"]
        correct_label = TYPES[correct_code]["label"]
        explanation = ch.get("explanation", "")

        first = answers_first.get(ch_id)
        final = answers_final.get(ch_id, first)

        if first is None:
            first_text = "–æ—Ç–≤–µ—Ç–∞ –Ω–µ –±—ã–ª–æ"
        else:
            first_label = TYPES.get(first["chosen"], {"label": "?"})["label"]
            suffix = " (–≤–µ—Ä–Ω–æ)" if first["correct"] else " (–Ω–µ–≤–µ—Ä–Ω–æ)"
            first_text = first_label + suffix

        extra_line = ""
        if final is not None and first is not None and final["chosen"] != first["chosen"]:
            final_label = TYPES.get(final["chosen"], {"label": "?"})["label"]
            suffix = " (–≤–µ—Ä–Ω–æ)" if final["correct"] else " (–Ω–µ–≤–µ—Ä–Ω–æ)"
            extra_line = f"  –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ: {final_label}{suffix}."

        lines.append(
            f"\n‚Ä¢ {name}: –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç ‚Äî {first_text}. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø–∞–∂: {correct_label}."
        )
        if extra_line:
            lines.append(extra_line)
        if explanation:
            lines.append(f"  –ü–æ—á–µ–º—É —Ç–∞–∫: {explanation}")

    lines.append(
        "\n–≠—Ç–æ –±—ã–ª–∞ –ß–∞—Å—Ç—å 1 ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∏–ø–∞–∂–µ–π –≤ –±–æ–ª—å—à–æ–π –∫–æ–º–∞–Ω–¥–µ.\n"
        "–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ –ß–∞—Å—Ç—å 2 ‚Äî —Å–∏–º—É–ª—è—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π: "
        "–∫–∞–∫ –≤—ã–±–æ—Ä –ª–∏–¥–µ—Ä–æ–≤, –ø—Ä–µ–º–∏–π –∏ —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å—é –±—å—ë—Ç –ø–æ –¥–µ–Ω—å–≥–∞–º –∏ –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç–∏."
    )

    return "\n".join(lines)

# ============================================================
#                 –ß–ê–°–¢–¨ 2. –°–ò–ú–£–õ–Ø–¶–ò–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø
# ============================================================

def init_sim_state(context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏.
    """
    user_data = context.user_data
    user_data["sim"] = {
        "current_scene": 0,
        "money": 100,        # 100 ‚Äî —É—Å–ª–æ–≤–Ω–∞—è –±–∞–∑–æ–≤–∞—è —Ç–æ—á–∫–∞
        "engagement": 70,    # —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å
        "risk": 20,          # —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è/—Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
        "decisions": [],     # —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π
    }


def build_scene_text(sim: dict) -> str:
    """
    –¢–µ–∫—Å—Ç —Å—Ü–µ–Ω—ã —Å —Ç–µ–∫—É—â–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏.
    """
    idx = sim["current_scene"]
    scene = SCENES[idx]

    money = sim["money"]
    engagement = sim["engagement"]
    risk = sim["risk"]

    return (
        f"{scene['title']}\n\n"
        f"{scene['description']}\n\n"
        f"{scene['question']}\n\n"
        f"üìä –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫–æ–º–ø–∞–Ω–∏–∏:\n"
        f"‚Äî –î–µ–Ω—å–≥–∏: {money} (100 ‚Äî –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å)\n"
        f"‚Äî –í–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å: {engagement}\n"
        f"‚Äî –†–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è/—Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏: {risk}"
    )


def build_scene_keyboard(scene_index: int) -> InlineKeyboardMarkup:
    """
    –ö–Ω–æ–ø–∫–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ä–µ—à–µ–Ω–∏–π –¥–ª—è —Å—Ü–µ–Ω—ã.
    """
    scene = SCENES[scene_index]
    buttons = []
    for i, opt in enumerate(scene["options"]):
        buttons.append(
            [
                InlineKeyboardButton(
                    opt["label"],
                    callback_data=f"SIM:{scene_index}:{i}",
                )
            ]
        )
    return InlineKeyboardMarkup(buttons)


async def send_scene(chat_id: int, context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ü–µ–Ω—É —Å–∏–º—É–ª—è—Ü–∏–∏.
    """
    user_data = context.user_data
    sim = user_data.get("sim")
    if not sim:
        return

    idx = sim["current_scene"]
    text = build_scene_text(sim)
    keyboard = build_scene_keyboard(idx)
    await context.bot.send_message(chat_id=chat_id, text=text, reply_markup=keyboard)


def format_sim_summary(user_data: dict) -> str:
    """
    –ò—Ç–æ–≥ —Å–∏–º—É–ª—è—Ü–∏–∏: —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ + —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞.
    """
    sim = user_data.get("sim", {})
    if not sim:
        return "–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ."

    money = sim.get("money", 100)
    engagement = sim.get("engagement", 70)
    risk = sim.get("risk", 20)
    decisions = sim.get("decisions", [])

    lines = ["–ò—Ç–æ–≥–∏ —Å–∏–º—É–ª—è—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π:\n"]

    # –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–µ–Ω–µ–≥
    if money < 80:
        money_text = "–ö–æ–º–ø–∞–Ω–∏—è –Ω–µ–¥–æ–∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–ª–∏ —Ç–µ—Ä—è–µ—Ç –¥–µ–Ω—å–≥–∏ –∏–∑-–∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π."
    elif money <= 120:
        money_text = "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –∫–æ—Ä–∏–¥–æ—Ä–µ: –±–µ–∑ —Ä—ã–≤–∫–æ–≤, –Ω–æ –∏ –±–µ–∑ –ø—Ä–æ–≤–∞–ª–æ–≤."
    else:
        money_text = "–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–æ—Å—Ç –ø–æ –¥–µ–Ω—å–≥–∞–º, –Ω–æ –≤–∞–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫–æ–π —Ü–µ–Ω–æ–π —ç—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è."

    # –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç–∏
    if engagement < 50:
        engagement_text = "–í–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–µ–ª–∞: —á–∞—Å—Ç—å –ª—é–¥–µ–π –≤—ã–≥–æ—Ä–µ–ª–∞ –∏–ª–∏ —É—à–ª–∞ –≤ –ø–∞—Å—Å–∏–≤–Ω—ã–π —Å–∞–±–æ—Ç–∞–∂."
    elif engagement <= 80:
        engagement_text = "–í–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –Ω–µ—Ä–æ–≤–Ω–∞—è: —á–∞—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã —Ç—è–Ω–µ—Ç, —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç ¬´–ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏¬ª."
    else:
        engagement_text = "–ö–æ–º–∞–Ω–¥–∞ –≤ —Ü–µ–ª–æ–º –≤–æ–≤–ª–µ—á–µ–Ω–∞ –∏ —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–º—ã—Å–ª –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ."

    # –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–∏—Å–∫–∞
    if risk > 60:
        risk_text = "–†–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è –∏ —Ç–æ–∫—Å–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤—ã—Å–æ–∫–∏–π ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ª—é–¥—è—Ö."
    elif risk >= 30:
        risk_text = "–†–∏—Å–∫ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π, –Ω–æ —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –≤–∞–∂–Ω—ã —Ç–æ—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ –ª—é–¥—è–º."
    else:
        risk_text = "–†–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è –∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –Ω–∏–∑–∫–∏–π ‚Äî —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–æ–π—á–∏–≤–∞."

    lines.append(f"üí∞ –î–µ–Ω—å–≥–∏: {money} (–±–∞–∑–∞ 100). {money_text}")
    lines.append(f"üî• –í–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å: {engagement}. {engagement_text}")
    lines.append(f"‚ö†Ô∏è –†–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è/—Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏: {risk}. {risk_text}\n")

    lines.append("–ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è:")
    for d in decisions:
        lines.append(
            f"\n{d['scene_title']}\n"
            f"‚Äî –¢–≤–æ–π –≤—ã–±–æ—Ä: {d['option_label']}\n"
            f"  –≠—Ñ—Ñ–µ–∫—Ç: –¥–µ–Ω—å–≥–∏ {d['d_money']:+}, –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å {d['d_engagement']:+}, —Ä–∏—Å–∫ {d['d_risk']:+}.\n"
            f"  –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: {d['comment']}"
        )

    lines.append(
        "\n–°–º—ã—Å–ª —Å–∏–º—É–ª—è—Ü–∏–∏: –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å—Ç–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ª—é–±—ã—Ö —Ü–µ–Ω–æ–π —É—Å–∏–ª–∏–≤–∞–µ—Ç –ö—Ä—ã—Å –∏ –õ–∏—Å, "
        "–≤—ã–∂–∏–≥–∞–µ—Ç –•–æ–º—è–∫–æ–≤ –∏ —è–¥—Ä–æ, –∞ —Å—Ç–∞–≤–∫–∞ –Ω–∞ —è–¥—Ä–æ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–∞—ë—Ç –º–µ–Ω—å—à–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ "
        "–≤—ã–∏–≥—Ä—ã—à–∞, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∏—Å—Ç–µ–º—É –∏ –¥–µ–Ω—å–≥–∏ –≤ –¥–æ–ª–≥—É—é."
    )

    return "\n".join(lines)

# ============================================================
#                    –û–ë–©–ò–ï –•–ï–ù–î–õ–ï–†–´
# ============================================================

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    text = (
        "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø –∏–≥—Ä—ã ¬´–¢–µ—Ä–µ–º–æ–∫: —Å–∏–º—É–ª—è—Ç–æ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞¬ª.\n\n"
        "–ß–∞—Å—Ç—å 1 ‚Äî —Ç–µ—Å—Ç ¬´–ö—Ç–æ –µ—Å—Ç—å –∫—Ç–æ –≤ —Ç–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏¬ª.\n"
        "–ß–∞—Å—Ç—å 2 ‚Äî –∫–æ—Ä–æ—Ç–∫–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π: –∫–∞–∫ –≤—ã–±–æ—Ä –ª–∏–¥–µ—Ä–æ–≤, –ø—Ä–µ–º–∏–π –∏ —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å—é\n"
        "–≤–ª–∏—è–µ—Ç –Ω–∞ –¥–µ–Ω—å–≥–∏, –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –∏ —Ä–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è."
    )

    keyboard = [
        [
            InlineKeyboardButton(
                "‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç ¬´–ö—Ç–æ –µ—Å—Ç—å –∫—Ç–æ¬ª (–ß–∞—Å—Ç—å 1)", callback_data="START_QUIZ"
            )
        ],
        [
            InlineKeyboardButton(
                "üéÆ –°–∏–º—É–ª—è—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ß–∞—Å—Ç—å 2)", callback_data="START_SIM"
            )
        ],
        [
            InlineKeyboardButton(
                "‚ÑπÔ∏è –ö–æ—Ä–æ—Ç–∫–æ –æ —Ç–∏–ø–∞–∂–∞—Ö –¢–µ—Ä–µ–º–∫–∞", callback_data="ABOUT_MODEL"
            )
        ],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    if update.message:
        await update.message.reply_text(text, reply_markup=reply_markup)
    else:
        await update.effective_chat.send_message(text, reply_markup=reply_markup)


async def about_model(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    text = (
        "–ö—Ä–∞—Ç–∫–æ –æ —Ç–∏–ø–∞–∂–∞—Ö –º–æ–¥–µ–ª–∏ ¬´–¢–µ—Ä–µ–º–æ–∫¬ª:\n\n"
        "üê¶ –ü—Ç–∏—Ü–∞ ‚Äî –∂–∏–≤—ë—Ç –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ –∏ –Ω–æ–≤–∏–∑–Ω–æ–π; –ª–µ–≥–∫–æ –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è –∏ —Ç–∞–∫ –∂–µ –ª–µ–≥–∫–æ –æ—Å—Ç—ã–≤–∞–µ—Ç.\n"
        "üêπ –•–æ–º—è–∫ ‚Äî —Ü–µ–Ω–∏—Ç –¥–µ–Ω—å–≥–∏, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞; –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ö–∞–æ—Å.\n"
        "ü¶ä –õ–∏—Å–∞ ‚Äî –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –ª–∏—á–Ω—É—é –≤—ã–≥–æ–¥—É, —Å—Ç–∞—Ç—É—Å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏; —Å–∏–ª—å–Ω—ã–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏.\n"
        "üêÄ –ö—Ä—ã—Å–∞ ‚Äî –õ–∏—Å–∞, —É—à–µ–¥—à–∞—è –≤ —Ç–æ–∫—Å–∏–∫: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –≤–ª–∏—è–Ω–∏–µ, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ —Å–∏—Å—Ç–µ–º—ã.\n"
        "üëî –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª ‚Äî —Å—Ç—Ä–æ–∏—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—é –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ, —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö.\n"
        "üêª –ú–µ–¥–≤–µ–¥—å ‚Äî –æ–ø–æ—Ä–Ω—ã–π, ¬´—Ç—è–∂—ë–ª—ã–π¬ª —Ç–∏–ø–∞–∂, —á–∞—Å—Ç–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫; –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—à–ª—ã–π –æ–ø—ã—Ç –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.\n"
        "üÖ∞Ô∏è –ê–ª—å—Ñ–∞-–ª–∏–¥–µ—Ä ‚Äî –∑–∞–¥–∞—ë—Ç –∏–¥–µ—é –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏, —Å–æ–±–∏—Ä–∞–µ—Ç –ª—é–¥–µ–π –≤–æ–∫—Ä—É–≥ —Å–º—ã—Å–ª–∞.\n"
        "üÖ±Ô∏è –ë–µ—Ç–∞-–ª–∏–¥–µ—Ä ‚Äî –¥–µ—Ä–∂–∏—Ç –∫–æ–º–∞–Ω–¥—É –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∏–¥–µ—é –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.\n\n"
        "–ß–∞—Å—Ç—å 1 –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—É—á–∏—Ç—å—Å—è –≤–∏–¥–µ—Ç—å, –∫—Ç–æ –µ—Å—Ç—å –∫—Ç–æ.\n"
        "–ß–∞—Å—Ç—å 2 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ —ç—Ç–∏–º —Ç–∏–ø–∞–∂–∞–º –±—å—é—Ç –ø–æ —Å–∏—Å—Ç–µ–º–µ."
    )

    await context.bot.send_message(chat_id=query.message.chat_id, text=text)

# -----------------------------
# –°–¢–ê–†–¢ –ö–í–ò–ó–ê (–ß–ê–°–¢–¨ 1)
# -----------------------------

async def start_quiz(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    init_quiz_state(context)
    user_data = context.user_data
    quiz = user_data["quiz"]

    lines = ["–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç (–ß–∞—Å—Ç—å 1).\n", "–í –∫–æ–º–ø–∞–Ω–∏–∏ —Å–µ–π—á–∞—Å —Ç–∞–∫–∞—è –∫–æ–º–∞–Ω–¥–∞:"]
    for ch in quiz["characters"]:
        lines.append(f"‚Ä¢ {ch['name']} ‚Äî {ch['role']}")
    lines.append(
        "\n–°–Ω–∞—á–∞–ª–∞ —Ç—ã –≤—ã–±–µ—Ä–µ—à—å —Ç–∏–ø–∞–∂–∏ –¥–ª—è –≤—Å–µ—Ö. "
        "–ü–æ—Ç–æ–º —è –≤–µ—Ä–Ω—É—Å—å —Ç–æ–ª—å–∫–æ –∫ —Ç–µ–º –∫–µ–π—Å–∞–º, –≥–¥–µ –±—ã–ª–∏ –æ—à–∏–±–∫–∏. "
        "–ü–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä —É–≤–∏–¥–∏—à—å –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ."
    )
    text = "\n".join(lines)

    await query.edit_message_text(text)
    await send_first_question(chat_id=query.message.chat_id, context=context)

# -----------------------------
# –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–í–ï–¢–ê –í –ö–í–ò–ó–ï
# -----------------------------

async def process_quiz_answer(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    data = query.data
    await query.answer()

    try:
        _, type_code = data.split(":", 1)
    except ValueError:
        await query.edit_message_text("–ù–µ–ø–æ–Ω—è—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")
        return

    user_data = context.user_data
    quiz = user_data.get("quiz")
    if not quiz:
        await query.edit_message_text("–°–µ—Å—Å–∏—è —Ç–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")
        return

    characters = quiz["characters"]
    total = quiz["total"]

    # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞—É–Ω–¥
    if quiz["phase"] == "main":
        idx = quiz["current_index"]
        if idx >= total:
            await query.edit_message_text("–¢–µ—Å—Ç —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑.")
            return

        ch = characters[idx]
        ch_id = ch["id"]
        correct_code = ch["correct_type"]
        is_correct = (type_code == correct_code)

        quiz["answers_first"][ch_id] = {
            "chosen": type_code,
            "correct": is_correct,
        }
        # –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–≤–µ–Ω –ø–µ—Ä–≤–æ–º—É, –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ —Ä–µ—Ç—Ä–∞—è
        quiz["answers_final"][ch_id] = {
            "chosen": type_code,
            "correct": is_correct,
        }

        quiz["current_index"] += 1

        if quiz["current_index"] < total:
            # –°–ª–µ–¥—É—é—â–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ç–æ–≥–æ –∂–µ —Ä–∞—É–Ω–¥–∞
            text = build_main_question_text(characters, quiz["current_index"], total)
            keyboard = build_types_keyboard()
            await query.edit_message_text(text=text, reply_markup=keyboard)
        else:
            # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—à–∏–±–∫–∏
            wrong_indices = [
                i
                for i, c in enumerate(characters)
                if not quiz["answers_first"].get(c["id"], {}).get("correct")
            ]
            score_first = sum(
                1
                for c in characters
                if quiz["answers_first"].get(c["id"], {}).get("correct")
            )
            quiz["score_first"] = score_first

            if wrong_indices:
                # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É —Ä–∞—É–Ω–¥—É –ø–æ –æ—à–∏–±–æ—á–Ω—ã–º
                quiz["phase"] = "retry"
                quiz["retry_ids"] = wrong_indices
                quiz["current_index"] = 0
                n_wrong = len(wrong_indices)
                msg = (
                    f"–° –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞ —Ç—ã –≤–µ—Ä–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏–ª {score_first} –∏–∑ {total} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.\n"
                    f"–î–∞–≤–∞–π –µ—â—ë —Ä–∞–∑ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ {n_wrong} —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö –∫–µ–π—Å–æ–≤."
                )
                await query.edit_message_text(msg)

                # –ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
                text_retry = build_retry_question_text(quiz, 0)
                keyboard = build_types_keyboard()
                await context.bot.send_message(
                    chat_id=query.message.chat_id, text=text_retry, reply_markup=keyboard
                )
            else:
                # –ù–µ—Ç –æ—à–∏–±–æ–∫ ‚Äî —Å—Ä–∞–∑—É –¥–∞—ë–º –∏—Ç–æ–≥–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä
                summary_text = format_quiz_summary(user_data)
                await query.edit_message_text(
                    "–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –≤—Å—ë —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞! –ù–∏–∂–µ —Ä–∞–∑–±–æ—Ä."
                )
                keyboard = InlineKeyboardMarkup(
                    [
                        [
                            InlineKeyboardButton(
                                "üîÅ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â—ë —Ä–∞–∑", callback_data="START_QUIZ"
                            )
                        ]
                    ]
                )
                await context.bot.send_message(
                    chat_id=query.message.chat_id,
                    text=summary_text,
                    reply_markup=keyboard,
                )

    # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–∞—É–Ω–¥ —Ç–æ–ª—å–∫–æ –ø–æ –æ—à–∏–±–æ—á–Ω—ã–º
    elif quiz["phase"] == "retry":
        retry_ids = quiz["retry_ids"]
        idx_retry = quiz["current_index"]
        if idx_retry >= len(retry_ids):
            await query.edit_message_text("–ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–∞—É–Ω–¥ —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω.")
            return

        char_idx = retry_ids[idx_retry]
        ch = characters[char_idx]
        ch_id = ch["id"]
        correct_code = ch["correct_type"]
        is_correct = (type_code == correct_code)

        # –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ —ç—Ç–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É
        quiz["answers_final"][ch_id] = {
            "chosen": type_code,
            "correct": is_correct,
        }

        quiz["current_index"] += 1

        if quiz["current_index"] < len(retry_ids):
            # –°–ª–µ–¥—É—é—â–∏–π –∫–µ–π—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            text_retry = build_retry_question_text(quiz, quiz["current_index"])
            keyboard = build_types_keyboard()
            await query.edit_message_text(text=text_retry, reply_markup=keyboard)
        else:
            # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî –¥–∞—ë–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä
            await query.edit_message_text(
                "–í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤—Ç–æ—Ä–æ–π –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏–Ω—è—Ç—ã. –ù–∏–∂–µ ‚Äî —Ä–∞–∑–±–æ—Ä –ø–æ –≤—Å–µ–π –∫–æ–º–∞–Ω–¥–µ."
            )
            summary_text = format_quiz_summary(user_data)
            keyboard = InlineKeyboardMarkup(
                [
                    [
                        InlineKeyboardButton(
                            "üîÅ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â—ë —Ä–∞–∑", callback_data="START_QUIZ"
                        )
                    ]
                ]
            )
            await context.bot.send_message(
                chat_id=query.message.chat_id,
                text=summary_text,
                reply_markup=keyboard,
            )
    else:
        await query.edit_message_text("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∞. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")

# -----------------------------
# –°–¢–ê–†–¢ –°–ò–ú–£–õ–Ø–¶–ò–ò (–ß–ê–°–¢–¨ 2)
# -----------------------------

async def start_sim(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    init_sim_state(context)
    user_data = context.user_data
    sim = user_data["sim"]

    intro = (
        "–ó–∞–ø—É—Å–∫–∞–µ–º –ß–∞—Å—Ç—å 2 ‚Äî —Å–∏–º—É–ª—è—Ü–∏—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.\n\n"
        "–£ –∫–æ–º–ø–∞–Ω–∏–∏ –µ—Å—Ç—å —Ç—Ä–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è:\n"
        "üí∞ –î–µ–Ω—å–≥–∏ (–±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å ‚Äî 100).\n"
        "üî• –í–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã.\n"
        "‚ö†Ô∏è –†–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è –∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏.\n\n"
        "–¢—ã –ø—Ä–∏–º–µ—à—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π, –∞ –∑–∞—Ç–µ–º —É–≤–∏–¥–∏—à—å, "
        "–∫–∞–∫ —ç—Ç–∏ —Ä–µ—à–µ–Ω–∏—è –±—å—é—Ç –ø–æ —Å–∏—Å—Ç–µ–º–µ –∏ –¥–µ–Ω—å–≥–∞–º."
    )
    await query.edit_message_text(intro)
    await send_scene(chat_id=query.message.chat_id, context=context)

# -----------------------------
# –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–í–ï–¢–ê –í –°–ò–ú–£–õ–Ø–¶–ò–ò
# -----------------------------

async def process_sim_answer(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    data = query.data
    await query.answer()

    try:
        _, scene_idx_str, opt_idx_str = data.split(":", 2)
        scene_idx = int(scene_idx_str)
        opt_idx = int(opt_idx_str)
    except ValueError:
        await query.edit_message_text("–ù–µ–ø–æ–Ω—è—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ —Å–∏–º—É–ª—è—Ü–∏–∏. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")
        return

    user_data = context.user_data
    sim = user_data.get("sim")
    if not sim:
        await query.edit_message_text("–°–µ—Å—Å–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")
        return

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –Ω—É–∂–Ω–æ–π —Å—Ü–µ–Ω–µ
    current_scene = sim["current_scene"]
    if scene_idx != current_scene or scene_idx >= len(SCENES):
        await query.edit_message_text("–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–±–∏–ª–æ—Å—å. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")
        return

    scene = SCENES[scene_idx]
    if opt_idx < 0 or opt_idx >= len(scene["options"]):
        await query.edit_message_text("–ù–µ–≤–µ—Ä–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")
        return

    option = scene["options"][opt_idx]

    # –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
    sim["money"] += option["d_money"]
    sim["engagement"] += option["d_engagement"]
    sim["risk"] += option["d_risk"]

    # –õ—ë–≥–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π (–≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö)
    sim["money"] = max(0, min(sim["money"], 200))
    sim["engagement"] = max(0, min(sim["engagement"], 120))
    sim["risk"] = max(0, min(sim["risk"], 120))

    sim["decisions"].append(
        {
            "scene_id": scene["id"],
            "scene_title": scene["title"],
            "option_label": option["label"],
            "d_money": option["d_money"],
            "d_engagement": option["d_engagement"],
            "d_risk": option["d_risk"],
            "comment": option["comment"],
        }
    )

    # –ö—Ä–∞—Ç–∫–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
    feedback = (
        f"–¢–≤–æ—ë —Ä–µ—à–µ–Ω–∏–µ:\n{scene['title']}\n‚Äî {option['label']}\n\n"
        f"–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º: –¥–µ–Ω—å–≥–∏ {option['d_money']:+}, "
        f"–≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å {option['d_engagement']:+}, —Ä–∏—Å–∫ {option['d_risk']:+}."
    )
    await query.edit_message_text(feedback)

    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∞–µ–º
    sim["current_scene"] += 1
    if sim["current_scene"] < len(SCENES):
        await send_scene(chat_id=query.message.chat_id, context=context)
    else:
        summary_text = format_sim_summary(user_data)
        keyboard = InlineKeyboardMarkup(
            [
                [
                    InlineKeyboardButton(
                        "üîÅ –°—ã–≥—Ä–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é –µ—â—ë —Ä–∞–∑", callback_data="START_SIM"
                    )
                ]
            ]
        )
        await context.bot.send_message(
            chat_id=query.message.chat_id, text=summary_text, reply_markup=keyboard
        )

# -----------------------------
# –û–ë–©–ò–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–û–ö
# -----------------------------

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    data = query.data

    if data == "START_QUIZ":
        await start_quiz(update, context)
        return

    if data == "ABOUT_MODEL":
        await about_model(update, context)
        return

    if data == "START_SIM":
        await start_sim(update, context)
        return

    if data.startswith("QUIZ:"):
        await process_quiz_answer(update, context)
        return

    if data.startswith("SIM:"):
        await process_sim_answer(update, context)
        return

    await query.answer()
    await query.edit_message_text("–ù–µ–ø–æ–Ω—è—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.")

# -----------------------------
# –¢–û–ß–ö–ê –í–•–û–î–ê
# -----------------------------

def main() -> None:
    app = ApplicationBuilder().token(TELEGRAM_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(button_handler))

    app.run_polling()


if __name__ == "__main__":
    main()
