const tg = window.Telegram.WebApp;
tg.expand();

// Embedded types data
const TYPES_DATA = {
    bird: { emoji: "üê¶", name_ru: "–ü—Ç–∏—Ü–∞", short_desc: "–°–æ—Ç—Ä—É–¥–Ω–∏–∫, —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–∏–π —Ä–∞–±–æ—Ç—É. –õ–∏—à–µ–Ω –ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.", markers: ["–ß–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É (–ª–µ—Ç—É–Ω).", "–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.", "–ù–µ—Ç –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.", "–ü—Ä–∏ –º–∞–ª–µ–π—à–∏—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç—è—Ö –ø–æ–∫–∏–¥–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏—é."], risks: "–£–π–¥—ë—Ç –ø—Ä–∏ –ø–µ—Ä–≤—ã—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç—è—Ö, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.", management_advice: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: ¬´–ü–æ–¥—Ä–µ–∑–∞—Ç—å –∫—Ä—ã–ª—å—è¬ª ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω—É–∂–¥—É (–∫—Ä–µ–¥–∏—Ç, —Å–µ–º—å—è). –¢–∞–∫—Ç–∏–∫–∞: ¬´–°–¥–µ–ª–∞–π —ç—Ç–æ ‚Äî –∏ —Å–≤–æ–±–æ–¥–µ–Ω¬ª." },
    hamster: { emoji: "üêπ", name_ru: "–•–æ–º—è–∫", short_desc: "–û—Ä–∏–µ–Ω—Ç–∏—Ä –æ–≤–∞–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –¥–µ–Ω—å–≥–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–ª–∞–≥–∞ –∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å.", markers: ["–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞—Ä–ø–ª–∞—Ç–∞, '–ø–ª—é—à–∫–∏' –∏ –æ–ø–ª–∞—Ç–∞ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.", "–î–µ–≤–∏–∑: ¬´–í—Å—ë, —á—Ç–æ –Ω–µ –ø—Ä–æ –¥–µ–Ω—å–≥–∏ ‚Äî –ø–æ–Ω–∞—Ä–æ—à–∫—É¬ª.", "–ù–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–æ–π.", "–ú–æ–∂–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (–∫–ª–∏–µ–Ω—Ç–æ–≤) –≤ —Å–≤–æ–µ–π ¬´–Ω–æ—Ä–∫–µ¬ª."], risks: "–£–π–¥—ë—Ç, –µ—Å–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∞—Ç –Ω–∞ —Ä—É–±–ª—å –±–æ–ª—å—à–µ. –ú–æ–∂–µ—Ç –≤–æ—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —Å–∫—Ä—ã–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã.", management_advice: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è. –°–¥–µ–ª–∞—Ç—å '–Ω–æ—Ä–∫–∏' –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º–∏. –¢–∞–∫—Ç–∏–∫–∞: –ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å." },
    fox: { emoji: "ü¶ä", name_ru: "–õ–∏—Å–∞", short_desc: "–õ–∏—á–Ω–∞—è –≤—ã–≥–æ–¥–∞. –£–º–Ω–∞, —Ö–∏—Ç—Ä–∞, –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ –ø–æ–ª–µ–∑–Ω–æ–π (–∫–∞—Ä—å–µ—Ä–∏—Å—Ç), —Ç–∞–∫ –∏ —Ç–æ–∫—Å–∏—á–Ω–æ–π.", markers: ["–°–æ–∑–¥–∞—ë—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å –±—É—Ä–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.", "–í–∞–∂–Ω–µ–µ –∫–∞–∑–∞—Ç—å—Å—è, —á–µ–º –±—ã—Ç—å.", "–û—Ç–ª–∏—á–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏.", "–ù–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–¥–∞—ë—Ç —Å–µ–±—è –ª—É—á—à–µ –≤—Å–µ—Ö."], risks: "–ú–æ–∂–µ—Ç –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å, —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ç—Ä–∏–≥–∏, –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å —á—É–∂–∏–µ –∑–∞—Å–ª—É–≥–∏.", management_advice: "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: –†–∞—Å—Ç–∏—Ç—å –≤ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞. –¢–∞–∫—Ç–∏–∫–∞: –ñ—ë—Å—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è —Å—Ä–µ–¥–∞, –æ–±—É—á–µ–Ω–∏–µ." },
    rat: { emoji: "üêÄ", name_ru: "–ö—Ä—ã—Å–∞", short_desc: "–î–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–≤—à–∞—è –õ–∏—Å–∞. –¢–æ–∫—Å–∏—á–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫.", markers: ["–ò–Ω—Ç—Ä–∏–≥–∏, —Å–ø–ª–µ—Ç–Ω–∏, —Å—Ç—Ä–∞–≤–ª–∏–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–≥.", "–ú–∞–Ω–∏–ø—É–ª–∏—Ä—É–µ—Ç –¥–æ–≤–µ—Ä–∏–µ–º —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è.", "–ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã, –≤—Ä–µ–¥–∏—Ç –∫–æ–º–ø–∞–Ω–∏–∏ —Å–∫—Ä—ã—Ç–æ."], risks: "–†–∞–∑—Ä—É—à–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∞, –ø–æ—Ç–µ—Ä—è –∫–ª—é—á–µ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫—Ä–∞–∂–∞ –±–∞–∑—ã.", management_advice: "–£–≤–æ–ª—å–Ω—è—Ç—å. –ë–µ–∑ –∂–∞–ª–æ—Å—Ç–∏. –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ç –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∞ –¥–æ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è." },
    professional: { emoji: "üëî", name_ru: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª", short_desc: "–ú–æ—Ç–∏–≤: –ù—Ä–∞–≤–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞. –°–ø–ª–∞–≤ –∑–Ω–∞–Ω–∏–π, –Ω–∞–≤—ã–∫–æ–≤ –∏ —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π.", markers: ["–î–µ–ª–∞–µ—Ç –ø–æ —Å–æ–≤–µ—Å—Ç–∏, –¥–∞–∂–µ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è.", "–ü—Ä–∏–Ω–æ—Å–∏—Ç –ø–æ–ª—å–∑—É –∏ —Å–µ–±–µ, –∏ –∫–æ–º–ø–∞–Ω–∏–∏ (Win-Win).", "–ì–æ—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ –æ—à–∏–±–∫–∏.", "–ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º."], risks: "–ú–æ–∂–µ—Ç –≤—ã–≥–æ—Ä–µ—Ç—å, –µ—Å–ª–∏ –∏–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥—É—Ä–∞–∫. –ú–æ–∂–µ—Ç –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞—Ç—å –≤ –í–æ–ª–∫–∞.", management_advice: "–ù–µ –º–µ—à–∞—Ç—å. –ó–∞—â–∏—â–∞—Ç—å –æ—Ç –±—é—Ä–æ–∫—Ä–∞—Ç–∏–∏ –∏ —Ç–æ–∫—Å–∏—á–Ω—ã—Ö –õ–∏—Å. –î–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ." },
    wolf: { emoji: "üê∫", name_ru: "–í–æ–ª–∫", short_desc: "–î–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–≤—à–∏–π –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª. –°–æ–±–∏—Ä–∞–µ—Ç ¬´—Å—Ç–∞—é¬ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–∏.", markers: ["–°–æ–∑–¥–∞–µ—Ç —Å–≤–æ—é –∫–æ–º–∞–Ω–¥—É, –ø—Ä–µ–¥–∞–Ω–Ω—É—é –ª–∏—á–Ω–æ –µ–º—É.", "–î–∏–∫—Ç—É–µ—Ç —É—Å–ª–æ–≤–∏—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É/—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫—É.", "–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –∑–∞—â–∏—â–∞–µ—Ç —Å–≤–æ—é —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é."], risks: "–®–∞–Ω—Ç–∞–∂ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞, —É–≤–æ–¥ –±–∏–∑–Ω–µ—Å–∞ –∏–ª–∏ –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã.", management_advice: "–†–∞–∑–¥–µ–ª—è—Ç—å —Å—Ç–∞—é (–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã). –õ–∏—à–∞—Ç—å —Ä–µ—Å—É—Ä—Å–∞ –≤–ª–∏—è–Ω–∏—è. –£–≤–æ–ª—å–Ω—è—Ç—å –ª–∏–¥–µ—Ä–æ–≤ –±—É–Ω—Ç–∞." },
    bear: { emoji: "üêª", name_ru: "–ú–µ–¥–≤–µ–¥—å", short_desc: "¬´–Ø –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –ø—Ä–∞–≤–∏–ª¬ª. –û–ø—ã—Ç–Ω—ã–π, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π, –Ω–æ –Ω–µ—É–ø—Ä–∞–≤–ª—è–µ–º—ã–π.", markers: ["–ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã.", "–°—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –µ–º—É –º–æ–∂–Ω–æ –≤—Å—ë –∑–∞ –±—ã–ª—ã–µ –∑–∞—Å–ª—É–≥–∏.", "–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ–≥–¥–∞ —Ö–æ—á–µ—Ç –∏ –∫–∞–∫ —Ö–æ—á–µ—Ç."], risks: "–†–∞–∑–ª–∞–≥–∞–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É —Å–≤–æ–∏–º –ø—Ä–∏–º–µ—Ä–æ–º. –î–µ–º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –Ω–æ–≤–∏—á–∫–æ–≤.", management_advice: "–í–≤–æ–¥–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—é (–ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω –Ω–µ –Ω–µ–∑–∞–º–µ–Ω–∏–º). –ñ–µ—Å—Ç–∫–æ —Å—Ç–∞–≤–∏—Ç—å –≤ —Ä–∞–º–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ —Ä–æ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞." }
};

// FAQ Data
const FAQ_DATA = [
    { question: "–ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø–∞–∂ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?", answer: "–î–∞, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞. –õ–∏—Å—É –º–æ–∂–Ω–æ –≤—ã—Ä–∞—Å—Ç–∏—Ç—å –≤ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞ —á–µ—Ä–µ–∑ –æ–±—É—á–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å. –ü—Ç–∏—Ü—É –º–æ–∂–Ω–æ '–ø–æ–¥—Ä–µ–∑–∞—Ç—å –∫—Ä—ã–ª—å—è' (—Å–æ–∑–¥–∞—Ç—å –Ω—É–∂–¥—É). –ù–æ –ö—Ä—ã—Å—É –∏ –ú–µ–¥–≤–µ–¥—è –ª—É—á—à–µ —É–≤–æ–ª—å–Ω—è—Ç—å." },
    { question: "–ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø–∞–∂ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏?", answer: "–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã:\n- –ü—Ç–∏—Ü–∞: –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å –∫–µ–º-—Ç–æ, –º–Ω–æ–≥–æ –º–µ—Å—Ç —Ä–∞–±–æ—Ç—ã\n- –•–æ–º—è–∫: –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –¥–µ–Ω—å–≥–∏\n- –õ–∏—Å–∞: –∫—Ä–∞—Å–∏–≤–æ –≥–æ–≤–æ—Ä–∏—Ç, –Ω–æ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑–º—ã—Ç—ã\n- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã, –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –∑–∞–¥–∞—á–∏" },
    { question: "–ö–æ–≥–æ –±—Ä–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É?", answer: "–û—Å–Ω–æ–≤–∞ ‚Äî –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—ã. –•–æ–º—è–∫–æ–≤ –∏ –õ–∏—Å –º–æ–∂–Ω–æ –≤–∑—è—Ç—å, –Ω–æ –¥–µ—Ä–∂–∞—Ç—å –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∏ —Ä–∞—Å—Ç–∏—Ç—å. –ü—Ç–∏—Ü ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏. –ö—Ä—ã—Å, –í–æ–ª–∫–æ–≤, –ú–µ–¥–≤–µ–¥–µ–π ‚Äî –Ω–µ –±—Ä–∞—Ç—å." },
    { question: "–ö–∞–∫ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ç–∏–ø–∞–∂?", answer: "–ü—Ç–∏—Ü–∞: –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏\n–•–æ–º—è–∫: –¥–µ–Ω—å–≥–∏ –∏ KPI\n–õ–∏—Å–∞: —Å—Ç–∞—Ç—É—Å, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ, –∫–∞—Ä—å–µ—Ä–∞\n–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª: —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏, —Å–≤–æ–±–æ–¥–∞, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã" },
    { question: "–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –≤—Å—è –∫–æ–º–∞–Ω–¥–∞ ‚Äî –•–æ–º—è–∫–∏?", answer: "–í–Ω–µ–¥—Ä—è–π—Ç–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (–æ—Ç–∫—Ä—ã—Ç—ã–µ '–Ω–æ—Ä–∫–∏'), –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –æ–±—É—á–µ–Ω–∏–µ. –†–∞—Å—Ç–∏—Ç–µ –õ–∏—Å –≤ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤. –ü—Ä–∏–≤–æ–¥–∏—Ç–µ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤ –∏–∑–≤–Ω–µ –∫–∞–∫ –ø—Ä–∏–º–µ—Ä." }
];

// Diagnostic Questions
const DIAGNOSTIC_QUESTIONS = [
    {
        id: 1, text: "–í–∞—à –ø–æ–¥—Ö–æ–¥ –∫ –Ω–æ–≤—ã–º –∑–∞–¥–∞—á–∞–º –Ω–∞ —Ä–∞–±–æ—Ç–µ?", options: [
            { text: "–î–µ–ª–∞—é —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Å–∫–∞–∑–∞–ª–∏, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–æ–≥–∞–ª–∏.", score: { bird: 2 } },
            { text: "–°—Ä–∞–∑—É —Å–ø—Ä–∞—à–∏–≤–∞—é: '–ê —á—Ç–æ –º–Ω–µ –∑–∞ —ç—Ç–æ –¥–æ–ø–ª–∞—Ç—è—Ç?'", score: { hamster: 2 } },
            { text: "–ë–µ—Ä—É—Å—å, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ —à–µ—Ñ–æ–º.", score: { fox: 2 } },
            { text: "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –∏ —Å–¥–µ–ª–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ.", score: { professional: 2 } }
        ]
    },
    {
        id: 2, text: "–ß—Ç–æ –¥–ª—è –≤–∞—Å –∏–¥–µ–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å?", options: [
            { text: "–ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª—å–Ω–∏–∫ –≤ –∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–µ –∏ –º–æ–∂–Ω–æ —É–π—Ç–∏ –ø–æ—Ä–∞–Ω—å—à–µ.", score: { bird: 1, hamster: 1 } },
            { text: "–ö–æ–≥–¥–∞ —É–¥–∞–ª–æ—Å—å –∑–∞–∫–ª—é—á–∏—Ç—å –≤—ã–≥–æ–¥–Ω—É—é —Å–¥–µ–ª–∫—É –∏ –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å.", score: { hamster: 2 } },
            { text: "–ö–æ–≥–¥–∞ –º–µ–Ω—è –ø—É–±–ª–∏—á–Ω–æ –ø–æ—Ö–≤–∞–ª–∏–ª–∏ –Ω–∞ —Å–æ–±—Ä–∞–Ω–∏–∏.", score: { fox: 2 } },
            { text: "–ö–æ–≥–¥–∞ —É–¥–∞–ª–æ—Å—å —Ä–µ—à–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –∏ —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.", score: { professional: 2 } }
        ]
    },
    {
        id: 3, text: "–ö–∞–∫ –≤—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –æ—à–∏–±–∫–∞–º?", options: [
            { text: "–õ—É—á—à–µ –ø—Ä–æ–º–æ–ª—á–∞—Ç—å, –∞–≤–æ—Å—å –Ω–µ –∑–∞–º–µ—Ç—è—Ç.", score: { bird: 1, rat: 1 } },
            { text: "–í–∏–Ω–æ–≤–∞—Ç –Ω–µ —è, —ç—Ç–æ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞/–∫–æ–ª–ª–µ–≥–∏.", score: { fox: 1, hamster: 1 } },
            { text: "–ü—Ä–∏–∑–Ω–∞—é, –∏—â—É –ø—Ä–∏—á–∏–Ω—É –∏ –∏—Å–ø—Ä–∞–≤–ª—è—é, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä–∏–ª–æ—Å—å.", score: { professional: 2 } },
            { text: "–û—à–∏–±–∫–∏? –£ –º–µ–Ω—è –∏—Ö –Ω–µ –±—ã–≤–∞–µ—Ç, —ç—Ç–æ –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∞—é—Ç—Å—è.", score: { bear: 1, wolf: 1 } }
        ]
    },
    {
        id: 4, text: "–í–∞—à–∞ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –ø—Ä–æ—Å—å–±—É –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤ –≤—ã—Ö–æ–¥–Ω–æ–π (–±–µ–∑ –¥–æ–ø–ª–∞—Ç—ã)?", options: [
            { text: "–ù–∏ –∑–∞ —á—Ç–æ. –ù–µ—Ç –¥–µ–Ω–µ–≥ ‚Äî –Ω–µ—Ç —Ä–∞–±–æ—Ç—ã.", score: { hamster: 3 } },
            { text: "–ï—Å–ª–∏ —à–µ—Ñ –±—É–¥–µ—Ç –∏ —ç—Ç–æ –æ—Ü–µ–Ω–∏—Ç ‚Äî –≤—ã–π–¥—É.", score: { fox: 2 } },
            { text: "–ï—Å–ª–∏ —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –≤—ã–π–¥—É –∏ —Å–¥–µ–ª–∞—é.", score: { professional: 1 } },
            { text: "–ü—Ä–æ–º–æ–ª—á—É, –Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø—Ä–∏–¥—É –∏–ª–∏ –∑–∞–±–æ–ª–µ—é.", score: { bird: 2 } }
        ]
    },
    {
        id: 5, text: "–ß—Ç–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –≤–∞—Å?", options: [
            { text: "–ß—Ç–æ–±—ã –≤–æ–≤—Ä–µ–º—è –ø–ª–∞—Ç–∏–ª–∏ –∏ –Ω–µ —Ç—Ä–æ–≥–∞–ª–∏.", score: { bird: 1, hamster: 1 } },
            { text: "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å.", score: { fox: 2 } },
            { text: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–ª–ª–µ–∫—Ç–∏–≤ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏.", score: { professional: 2 } },
            { text: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —É—Å–∏–ª–∏—è—Ö.", score: { hamster: 2, rat: 1 } }
        ]
    }
];

let diagnosticState = { currentQuestion: 0, scores: {} };

// Section Navigation
function showSection(sectionName) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

    document.getElementById(`${sectionName}-section`).classList.add('active');
    event.target.classList.add('active');

    if (sectionName === 'types') renderTypesGrid();
    if (sectionName === 'faq') renderFAQ();
    if (sectionName === 'diagnostic') startDiagnostic();
}

// Types Grid
function renderTypesGrid() {
    const grid = document.getElementById('types-grid');
    const detail = document.getElementById('type-detail');
    detail.classList.add('hidden');
    grid.innerHTML = '';

    Object.keys(TYPES_DATA).forEach(key => {
        const t = TYPES_DATA[key];
        const card = document.createElement('div');
        card.className = 'type-card';
        card.onclick = () => showTypeDetail(t);
        card.innerHTML = `<span class="emoji">${t.emoji}</span><h3>${t.name_ru}</h3>`;
        grid.appendChild(card);
    });
}

function showTypeDetail(typeData) {
    const grid = document.getElementById('types-grid');
    const detail = document.getElementById('type-detail');
    grid.classList.add('hidden');
    detail.classList.remove('hidden');

    const markersHtml = typeData.markers.map(m => `<li>${m}</li>`).join('');
    detail.innerHTML = `
        <button class="back-btn" onclick="goBackToGrid()">‚¨Ö –ù–∞–∑–∞–¥</button>
        <span class="type-hero-emoji">${typeData.emoji}</span>
        <h2>${typeData.name_ru}</h2>
        <p style="text-align: center; color: #718096; margin-bottom: 20px;">${typeData.short_desc}</p>
        
        <div class="detail-section">
            <h4>üìã –ö–∞–∫ —É–∑–Ω–∞—Ç—å?</h4>
            <ul>${markersHtml}</ul>
        </div>
        
        <div class="detail-section">
            <h4>‚ö†Ô∏è –†–∏—Å–∫–∏</h4>
            <p style="color: #718096;">${typeData.risks}</p>
        </div>
        
        <div class="detail-section">
            <h4>üîß –°–æ–≤–µ—Ç—ã –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é</h4>
            <div class="advice-box">${typeData.management_advice}</div>
        </div>
    `;
}

function goBackToGrid() {
    document.getElementById('type-detail').classList.add('hidden');
    document.getElementById('types-grid').classList.remove('hidden');
}

// FAQ
function renderFAQ() {
    const list = document.getElementById('faq-list');
    list.innerHTML = '';

    FAQ_DATA.forEach((item, i) => {
        const faqItem = document.createElement('div');
        faqItem.className = 'faq-item';
        faqItem.innerHTML = `
            <div class="faq-question">${i + 1}. ${item.question}</div>
            <div class="faq-answer">${item.answer}</div>
        `;
        list.appendChild(faqItem);
    });
}

// Diagnostic
function startDiagnostic() {
    diagnosticState = { currentQuestion: 0, scores: {} };
    showQuestion();
}

function showQuestion() {
    const content = document.getElementById('diagnostic-content');
    const q = DIAGNOSTIC_QUESTIONS[diagnosticState.currentQuestion];

    const progress = ((diagnosticState.currentQuestion) / DIAGNOSTIC_QUESTIONS.length) * 100;

    const optionsHtml = q.options.map((opt, i) =>
        `<button class="option-btn" onclick="answerQuestion(${i})">${opt.text}</button>`
    ).join('');

    content.innerHTML = `
        <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%"></div></div>
        <div class="diagnostic-card">
            <p style="color: #718096; margin-bottom: 10px">–í–æ–ø—Ä–æ—Å ${diagnosticState.currentQuestion + 1} –∏–∑ ${DIAGNOSTIC_QUESTIONS.length}</p>
            <h3 class="question-text">${q.text}</h3>
            ${optionsHtml}
        </div>
    `;
}

function answerQuestion(optionIndex) {
    const q = DIAGNOSTIC_QUESTIONS[diagnosticState.currentQuestion];
    const score = q.options[optionIndex].score;

    for (let type in score) {
        diagnosticState.scores[type] = (diagnosticState.scores[type] || 0) + score[type];
    }

    diagnosticState.currentQuestion++;

    if (diagnosticState.currentQuestion >= DIAGNOSTIC_QUESTIONS.length) {
        showResult();
    } else {
        showQuestion();
    }
}

function showResult() {
    const sorted = Object.entries(diagnosticState.scores).sort((a, b) => b[1] - a[1]);
    const winnerId = sorted[0][0];
    const typeData = TYPES_DATA[winnerId];

    // Save result for contact form
    localStorage.setItem('diagnosticResult', `${typeData.emoji} ${typeData.name_ru}`);

    const content = document.getElementById('diagnostic-content');
    content.innerHTML = `
        <div class="result-card">
            <span class="result-emoji">${typeData.emoji}</span>
            <h2>–í—ã –±–ª–∏–∂–µ –∫ —Ç–∏–ø–∞–∂—É:</h2>
            <h1 style="margin-bottom: 20px">${typeData.name_ru}</h1>
            <p>${typeData.short_desc}</p>
            <p style="margin-top: 20px; opacity: 0.8; font-size: 0.9em;">–≠—Ç–æ –ª–∏—à—å –≥–∏–ø–æ—Ç–µ–∑–∞. –î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω—É–∂–Ω—ã –≥–ª—É–±–æ–∫–∏–µ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è.</p>
        </div>
        <button class="cta-button" style="margin-top: 20px" onclick="startDiagnostic()">–ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞</button>
        <button class="cta-button" style="margin-top: 10px; background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%)" onclick="showSectionWithResult('contact')">
            –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é ‚Üí
        </button>
    `;
}

// Write to bot function
function writeToBot() {
    if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.close();
    }
}

// Init
renderTypesGrid();
