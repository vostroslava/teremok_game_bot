{% extends "admin/base_admin.html" %}

{% block content %}
<div class="mb-8">
    <h1>üìä –î–∞—à–±–æ—Ä–¥</h1>
    <p style="color: var(--text-secondary);">–û–±–∑–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</p>
</div>

<!-- Stats Grid -->
<div class="grid-cols-4 mb-8">
    <div class="glass-panel stat-card">
        <div class="stat-label">–í—Å–µ–≥–æ –ª–∏–¥–æ–≤</div>
        <div class="stat-value">{{ stats.total_leads }}</div>
        <div class="badge badge-new">+{{ stats.leads_today }} —Å–µ–≥–æ–¥–Ω—è</div>
    </div>
    <div class="glass-panel stat-card">
        <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
        <div class="stat-value">{{ stats.total_tests }}</div>
        <div class="badge badge-active">+{{ stats.tests_today }} —Å–µ–≥–æ–¥–Ω—è</div>
    </div>
    <div class="glass-panel stat-card">
        <div class="stat-label">–õ–∏–¥—ã (7 –¥–Ω–µ–π)</div>
        <div class="stat-value">{{ stats.leads_7d }}</div>
    </div>
    <div class="glass-panel stat-card">
        <div class="stat-label">–¢–µ—Å—Ç—ã (7 –¥–Ω–µ–π)</div>
        <div class="stat-value">{{ stats.tests_7d }}</div>
    </div>
</div>

<!-- Activity Chart -->
<div class="glass-panel" style="padding: 24px; margin-bottom: 32px;">
    <h2>üìà –î–∏–Ω–∞–º–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
    <div style="height: 300px; width: 100%;">
        <canvas id="activityChart"></canvas>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('activityChart').getContext('2d');

        // Data from backend
        const labels = {{ chart_labels | tojson
    }};
    const leadsData = {{ chart_leads | tojson }};
    const testsData = {{ chart_tests | tojson }};

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: '–õ–∏–¥—ã',
                data: leadsData,
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: true,
                borderWidth: 2
            }, {
                label: '–¢–µ—Å—Ç—ã',
                data: testsData,
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                fill: true,
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: { color: '#e2e8f0', font: { family: "'Inter', sans-serif" } }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(255, 255, 255, 0.05)' },
                    ticks: { color: '#94a3b8', precision: 0 }
                },
                x: {
                    grid: { display: false },
                    ticks: { color: '#94a3b8' }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
    });
</script>

<div class="layout-container" style="gap: 24px; display: grid; grid-template-columns: 1fr 1fr;">
    <!-- Recent Leads -->
    <div class="glass-panel" style="padding: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>üë• –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–∏–¥—ã</h2>
            <a href="/app/admin/leads" class="btn btn-primary" style="font-size: 0.75rem;">–í—Å–µ –ª–∏–¥—ã</a>
        </div>

        {% if recent_leads %}
        <table>
            <thead>
                <tr>
                    <th>–ò–º—è</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in recent_leads %}
                <tr>
                    <td>
                        <div style="font-weight: 500;">{{ lead.name }}</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">{{ lead.created_at[:10] }}</div>
                    </td>
                    <td>{{ lead.phone }}</td>
                    <td><span class="badge badge-{{ lead.status or 'new' }}">{{ lead.status or 'new' }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty">–õ–∏–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
        {% endif %}
    </div>

    <!-- Recent Tests -->
    <div class="glass-panel" style="padding: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>üß© –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–µ—Å—Ç—ã</h2>
            <a href="/app/admin/tests" class="btn btn-primary" style="font-size: 0.75rem;">–í—Å–µ —Ç–µ—Å—Ç—ã</a>
        </div>

        {% if recent_tests %}
        <table>
            <thead>
                <tr>
                    <th>–ò–º—è</th>
                    <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                    <th>–ü—Ä–æ–¥—É–∫—Ç</th>
                </tr>
            </thead>
            <tbody>
                {% for test in recent_tests %}
                <tr>
                    <td>
                        <div style="font-weight: 500;">{{ test.name or '–ê–Ω–æ–Ω–∏–º' }}</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">{{ test.created_at[:10] }}</div>
                    </td>
                    <td>
                        <span style="font-size: 1.25rem;">{{ test.type_emoji }}</span>
                        {{ test.type_name or test.result_type }}
                    </td>
                    <td><span class="badge" style="background: rgba(255,255,255,0.1);">{{ test.product }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty">–¢–µ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
        {% endif %}
    </div>
</div>
{% endblock %}